<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="width=device-width, initial-scale=1.0">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>
    <link rel="stylesheet" href="css/home.css">
    <link rel="icon" href="img/icon.png" />
    <link rel="stylesheet" href="css/loader.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Sharp" rel="stylesheet">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Sharp:opsz,wght,FILL,GRAD@48,400,0,0" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://github.com/devongovett/pdfkit/releases/download/v0.10.0/pdfkit.standalone.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="javascript/loader.js"></script>


</head>

<body>


    <div class="containerr" id="conta">

        <div id="loading_spiner" class="modall">

            <div class="loaderr">

            </div>

        </div>

        <aside id="asidee">
            <div class="top">
                <div class="logo">
                    <img id="logop" src="img/logo.png">
                    <h2 class="sec">Light <span class="primary">Area</span> </h2>
                </div>
                <div class="close" id="close-btn">
                    <span class="material-symbols-sharp"> close</span>
                </div>
            </div>

            <div class="sidebar" id="homeSide">
                <a href="#" class="active" id="home_btn">
                    <span class="material-symbols-sharp">grid_view</span>
                    <h3>Home</h3>
                </a>
                <a href="#" id="course-btn">
                    <span class="material-symbols-sharp">import_contacts</span>
                    <h3>Courses </h3>
                </a>
                <a href="#" id="wallet-btn">
                    <span class="material-symbols-sharp">account_balance_wallet</span>
                    <h3>Wallet</h3>
                </a>

                <a href="#" id="report-btn" style="display: none;">
                    <span class="material-symbols-sharp">feed</span>
                    <h3>Reports</h3>
                </a>
                <a href="#" id="setting-btn">
                    <span class="material-symbols-sharp">settings</span>
                    <h3>Setting</h3>
                </a>
                <a href="#" id="logout-btn">
                    <span class="material-symbols-sharp">logout</span>
                    <h3>Logout </h3>
                </a>
            </div>
            <div class="sidebar " id="lecSide">
                <p class="prim-side">البيانات</p>

                <a href="#" id="editCoursee" class="editcourse  editbar">
                    <span class="material-symbols-sharp">edit</span>
                    <h3>تعديل الكورس</h3>
                </a>
                
                <a href="#" id="activeCourse" class="editbar">
                    <span class="material-symbols-sharp">new_releases</span>
                    <h3>تفعيل الكورس</h3>
                </a>


                <a href="#"  class="editbar">
                    <span class="material-symbols-sharp">bar_chart</span>
                    <h3> الاحصائيات</h3>
                </a>

                <hr>
                <p class="prim-side">المحتوي</p>


                <a href="#" id="add_video"class="editbar">
                    <span class="material-symbols-sharp">movie</span>
                    <h3>اضافة محاضرة</h3>
                </a>


                <a href="#" id="swap_lec"class="editbar">
                    <span class="material-symbols-sharp">swap_vert</span>
                    <h3>ترتيب الفديوهات</h3>
                </a>

                <a href="#" id="add_pdf" class="editbar">
                    <span class="material-symbols-sharp">picture_as_pdf</span>
                    <h3> Pdf اضافة </h3>
                </a>

                <a href="#" id="quiz_add" class="editbar">
                    <span class="material-symbols-sharp">quiz</span>
                    <h3>اضافة امتحان </h3>
                </a>

                <hr>
                <p class="prim-side">ادوات الكورس</p>


                <a href="#" class="editbar">
                    <span class="material-symbols-sharp">  confirmation_number</span>
                    <h3>انشاء كوبونات</h3>
                </a>

                <a href="#"  class="editbar">
                    <span class="material-symbols-sharp">notifications</span>
                    <h3> ارسال اشعار للطلاب  </h3>
                </a>

                <a href="#"  class="editbar">
                    <span class="material-symbols-sharp">groups</span>
                    <h3>الطلاب المسجلين بالكورس  </h3>
                </a>
                <a href="#" id="delete_course" class="editbar">
                    <span class="material-symbols-sharp">delete</span>
                    <h3> حذف الكورس</h3>
                </a>

                <a href="#" id="backToCourses">
                    <span class="material-symbols-sharp">undo</span>
                    <h3>رجوع </h3>
                </a>
            </div>
        </aside>
        <!---- END OF ASIDE ---->

        <!---- start OF home ---->

        <main id="home">
            <h1>Dashboard</h1>

            <div class="insights">

                <div class="income">
                    <span class="material-symbols-sharp">analytics</span>
                    <div class="middle">
                        <div class="left">
                            <h3>Current Balance </h3>
                            <h1 id="income">{analtyics}</h1>
                        </div>

                    </div>

                </div>
                <!------------------Last of income----------------->
                <div class="subscribers">
                    <span class="material-symbols-sharp">subscriptions</span>
                    <div class="middle">
                        <div class="left">
                            <h3>Total subscribers</h3>
                            <h1 id="sub">{analtycis}</h1>
                        </div>
                    </div>

                </div>
                <!------------------Last of subscrinbers----------------->
                <div class="followers">
                    <span class="material-symbols-sharp">person</span>
                    <div class="middle">
                        <div class="left">
                            <h3>Total Followers</h3>
                            <h1 id="follow">{analtycis}</h1>
                        </div>
                    </div>
                </div>
            </div>
            <!-------End of insights------------->
            <div class="charts">
                <h2>Total subscriptions </h2>
                <div class="date">
                    <select id="chartSelect">
                        <option value=1>today</option>
                        <option value=7>This week</option>
                        <option value=30>this month</option>
                        <option value=90>last 3 months</option>
                        <option value=180>last 6 months</option>
                        <option value=365>last year</option>
                        <option value=9999>life time</option>
                    </select>
                </div>
                <div id="chart" style="width:100%; height: 250px;"></div>
            </div>
            <!----End of charts--->
        </main>
        <div id="home-right" class="right">

            <div class="top">
                <button id="menu-btn_snow">
                    <span class="material-symbols-sharp">menu</span>
                </button>
                <div class="theme-toggler">
                    <span class="material-symbols-sharp active">light_mode</span>
                    <span class="material-symbols-sharp">dark_mode</span>
                </div>
                <div class="profile">
                    <div class="info">
                        <p>Hello Mr <b id="name">{Teacher name}</b></p>
                        <small class="text-muted">Teacher</small>
                    </div>
                    <div class="profile-photo">
                        <img id="profile-img" src="img/logo.png">
                    </div>
                </div>
            </div>
            <!--end of profile-->
            <div class="recent-updates">
                <h2>Recent Updates</h2>
                <div class="updates" id="updates">


                </div>

            </div>
        </div>
        <!----END OF home----->

        <!---- start OF course ---->

        <main id="course">
            <button id="menu-btn_snow" class="menu-btn_snow">
                <span class="material-symbols-sharp">menu</span>
            </button>
            <div class="container  mb-5">

                <div class="flex_Center">
                    <button class="btn btn-primary curo" id="pop_up">
                        <span class="material-symbols-sharp">add</span>أضافة كورس
                    </button>
                </div>

                <!----add course pop up----->
                <div id="myModal" class="modall">
                    <!-- Modal content -->
                    <div class="modal-contentt">
                        <span class="closee" id="close_course_Add">&times;</span>
                        <form>
                            <div class="form-row">
                                <div class="form-group col-md-6">
                                    <label for="inputEmail4">Course Name</label>
                                    <input type="text" class="form-control" id="course_name" placeholder="اسم الكورس">
                                    <p class="validation" id="course_name_validation">Course Name must be filled out</p>
                                </div>
                                <div class="form-group col-md-6">
                                    <label for="inputPassword4">Price</label>
                                    <input type="text" class="form-control" id="course_price" placeholder="سعر الكورس">
                                    <p class="validation" id="price_validation">Price must be filled out</p>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="inputAddress">Course Description</label>
                                <input type="text" class="form-control" id="course_desc" placeholder="وصف الكورس">
                                <p class="validation" id="course_description_validation">Course Description must be
                                    filled out</p>
                            </div>
                            <div class="form-row">
                                <div class="form-group col-md-6">
                                    <label for="inputState">Catagory</label>
                                    <select id="cat_Select" class="form-control">
                                    </select>
                                    <p class="validation" id="catagory_validation">Catagory must be filled out</p>
                                </div>
                                <div class="form-group col-md-6" id="hidecat">
                                    <label for="inputState">Sub Catagory</label>
                                    <select id="inputState" class="form-control" disabled>
                                        <option selected value="">NA</option>

                                    </select>

                                </div>


                                <div class="form-group col-md-6" id="subcat">
                                    <label for="inputState">Sub Catagory</label>
                                    <select id="subbcat" class="form-control">
                                    </select>
                                    <p class="validation" id="sub_catagory_validation">Sub Catagory must be filled out
                                    </p>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group col-md-6">
                                    <label for="inputEmail4" style="text-align:right ;display: block;">تاريخ انتهاء
                                        الكورس</label>
                                    <input type="date" class="form-control"
                                        title="قم بتعيين تاريخ انتهاء صلاحية للدورة التدريبية الخاصة بك ، عند الوصول إلى هذا التاريخ ، ستتم إزالة الدورة التدريبية تلقائيًا من حساب الطالب ، لاحظ أنه لا يمكنك تقريب هذا التاريخ ذلك لاحقًا ، و لكن يمكن اضافه المزيد من الوقت قبل  انتهاء الدوره ، فيه حاله انك لا ترغب في وضع انهاء الدوره اترك الحقل فارغا"
                                        id="expiredate" placeholder="تاريخ انتهاء الكورس">

                                </div>
                                <div class="form-group col-md-6">
                                    <label for="inputPassword4" style="text-align:right ; display: block;">قيود عدد
                                        المشاهدات</label>
                                    <input type="number"
                                        title="حدد عدد المرات التي يمكن للطالب مشاهدة كل مقطع فيديو فيها ، ولاحظ أنه إذا فتح الطالب مقطع الفيديو لمدة ثانية واحدة ، فسيتم احتسابه كمشاهدة ، بينما تعني القيمة 0 غير محدودة"
                                        class="form-control" id="watchcount" placeholder="0">

                                </div>
                            </div>
                            <div class="form-group">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="false" id="checksale">
                                    <label class="form-check-label" for="flexCheckDefault">
                                        يمكن للموزعين بيع الكورس الخاص بك ؟
                                    </label>
                                </div>
                            </div>

                            <div class="form-group">
                                <h2 class="mb-5 text-center">Course Image</h2>


                                <label class="text-center mb-5 image-preview-wrapper" for="file-uploader">
                                    <img src="https://image-placeholder.com/images/actual-size/640x640.png"
                                        id="course_img" alt="image-placehoder" class="img-thumbnail"
                                        data-target="image-preview">
                                    <p class="validation" id="image_catagory_validation">Course Image must be filled out
                                    </p>
                                    <div class="spinner-wrapper position-absolute" data-target="spinner">
                                        <div class="spinner-border text-secondary" role="status">
                                            <span class="sr-only">Loading...</span>
                                        </div>
                                    </div>
                                </label>


                                <div class="row">
                                    <div class="col-12 col-md-6 mx-auto" id="flex">
                                        <div class="custom-file">
                                            <input accept="image/*" type="file" class="custom-file-input"
                                                id="file-uploader">
                                            <label class="custom-file-label" for="customFile">Choose
                                                file</label>

                                        </div>
                                    </div>
                                </div>

                            </div>

                            <div class="form-groupp">
                                <button id="addcourse" type="button" class="btn btn-primary">Add Course</button>

                            </div>

                        </form>
                    </div>

                </div>

                <!----cards----->




                <div class="courses-content" id="listingCourse">
                    <h2 id="emptycourses" class="empty">لا يوجد كورسات الرجاء قم بأضافة كورسات </h2>
                </div>

                <nav class="pigi">
                    <div class="pagination">
                        <li class="page-item">
                            <button class="page-link " id="prev-btn"><span class="material-symbols-sharp">
                                    arrow_back
                                </span></button>
                        </li>
                        <li class="page-item">
                            <button class="page-link" id="next-btn"><span
                                    class="material-symbols-sharp">arrow_forward</span></button>
                        </li>
                    </div>
                </nav>
                <!----end of cards----->
            </div>
        </main>

        <main id="lectures">
                            <!----edit course pop up----->
                            <div id="myModal_course_edit" class="modall">
                                <!-- Modal content -->
                                <div class="modal-contentt">
                                    <span class="closee_course_edit">&times;</span>
                                    <form>
                                        <div class="form-row">
                                            <div class="form-group col-md-6">
                                                <label for="inputEmail4">Course Name</label>
                                                <input type="text" class="form-control" id="course_name_edit"
                                                    placeholder="اسم الكورس">
                                                <p class="validation" id="course_name_validation_edit">Course Name must be filled
                                                    out</p>
                                            </div>
                                            <div class="form-group col-md-6">
                                                <label for="inputPassword4">Price</label>
                                                <input type="text" class="form-control" id="course_price_edit"
                                                    placeholder="سعر الكورس">
                                                <p class="validation" id="price_validation_edit">Price must be filled out</p>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="inputAddress">Course Description</label>
                                            <input type="text" class="form-control" id="course_desc_edit" placeholder="وصف الكورس">
                                            <p class="validation" id="course_description_validation_edit">Course Description must be
                                                filled out</p>
                                        </div>
                                        <div class="form-row">
                                            <div class="form-group col-md-6">
                                                <label for="inputState">Catagory</label>
                                                <select id="cat_Select_edit" class="form-control">
                                                </select>
                                                <p class="validation" id="catagory_validation_edit">Catagory must be filled out</p>
                                            </div>
                                            <div class="form-group col-md-6" id="hidecat_edit">
                                                <label for="inputState">Sub Catagory</label>
                                                <select id="inputState_edit" class="form-control" disabled>
                                                    <option selected value="">NA</option>
            
                                                </select>
            
                                            </div>
            
            
                                            <div class="form-group col-md-6" id="subcat_edit">
                                                <label for="inputState">Sub Catagory</label>
                                                <select id="subbcat_edit" class="form-control">
                                                </select>
                                                <p class="validation" id="sub_catagory_validation_edit">Sub Catagory must be filled
                                                    out
                                                </p>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <h2 class="mb-5 text-center">Course Image</h2>
            
            
                                            <label class="text-center mb-5 image-preview-wrapper" for="file-uploader_edit">
                                                <img src="https://via.placeholder.com/300x300/efefef?text=Avatar" id="course_img"
                                                    alt="image-placehoder" class="img-thumbnail" data-target="image-preview_edit">
                                                <p class="validation" id="image_catagory_validation_edit">Course Image must be
                                                    filled out
                                                </p>
                                                <div class="spinner-wrapper position-absolute" data-target="spinner">
                                                    <div class="spinner-border text-secondary" role="status">
                                                        <span class="sr-only">Loading...</span>
                                                    </div>
                                                </div>
                                            </label>
            
            
                                            <div class="row">
                                                <div class="col-12 col-md-6 mx-auto" id="flex">
                                                    <div class="custom-file">
                                                        <input accept="image/*" type="file" class="custom-file-input"
                                                            id="file-uploader_edit">
                                                        <label class="custom-file-label" for="customFile">Choose
                                                            file</label>
            
                                                    </div>
                                                </div>
                                            </div>
            
                                        </div>
            
                                        <div class="form-groupp">
                                            <button id="update_course" class="btn btn-primary">Update Course</button>
            
                                        </div>
            
                                    </form>
                                </div>
            
                            </div>
            
                            <!----edelte course pop up----->
                            <div id="myModal_course_delete">
                                <!-- Modal content -->
                                <div class="modal-contentttt">
                                    <span class="close_course_delete" id="close_course_delete">&times;</span>
                                    <form>
            
                                        <h1>Delete Course</h1>
                                        <p>Are you sure you want to delete this Course?</p>
            
                                        <div class="clearfix">
                                            <button type="button" id="cancel_course" class="cancelbtn_pdf">Cancel</button>
                                            <button type="button" id="delete_coursee" class="delete_coursee">Delete</button>
                                        </div>
            
                                    </form>
                                </div>
            
                            </div>

            <button id="menu-btn_snow" class="menu-btn_snow">
                <span class="material-symbols-sharp">menu</span>
            </button>
            <ul class="breadcrumbb">
                <li><a href="#" id="course_lec_btn">Courses</a></li>
                <li><a href="#" class="lec_id2" id="lec_id"></a></li>
                <li><a href="#" class="active">Lectures</a></li>
            </ul>

            <div class="content">
                <button class="tablink" onclick="openPage('Home',this)" id="defaultOpen">Videos</button>
                <button class="tablink" onclick="openPage('News', this)">Pdf</button>
                <button class="tablink" onclick="openPage('Contact' ,this)">Quizez</button>

                <!----add lec pop up----->
                <div id="myModal_lec" class="modall">
                    <!-- Modal content -->
                    <div class="modal-content_lec">
                        <span class="close_lec" id="close_lec" data-bs-toggle="modal"
                            data-bs-target="#exampleModal">&times;</span>
                        <form>

                            <div class="form-group">
                                <label for="inputEmail4">lecture title</label>
                                <input type="text" class="form-control" id="lec_name" placeholder="عنوان المحاضره">
                                <p class="validation" id="lec_name_validation">Lecture title Name must be filled out
                                </p>
                            </div>
                            <div class="form-group">
                                <label for="inputAddress">Lecture Description</label>
                                <input type="text" class="form-control" id="lec_desc" placeholder="وصف المحاضرة">
                                <p class="validation" id="lec_description_validation">Lecture Description must be
                                    filled out</p>
                            </div>

                            <div class="form-group">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="false" id="checkScreenShot">
                                    <label class="form-check-label" for="flexCheckDefault">
                                        يمكن تصوير الشاشة ؟
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="false" id="checkfree">
                                    <label class="form-check-label" for="flexCheckDefault">
                                        الفديو مجاني ؟
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="true" id="checkNotifi"
                                        checked>
                                    <label class="form-check-label" for="flexCheckDefault">
                                        ارسال اشعار لجميع المشتركين في الكورس ؟
                                    </label>
                                </div>
                            </div>
                            <div>
                                <div id="drop_zone">Drop Files Here</div>
                                <label class="btn btn-block btn-info">
                                    Browse&hellip; <input id="browse" type="file" style="display: none;"
                                        accept="video/*">
                                </label>
                            </div>
                            <p class="validation" id="video_validation2">يجب ان لا يتجاوز مساحة الفديو 1 جيجا</p>
                            <p class="validation" id="video_validation">You didn't choose a video to upload</p>
                            <div id="progress-container" class="progress">
                                <div id="progress" class="progress-bar progress-bar-info progress-bar-striped active"
                                    role="progressbar" aria-valuenow="46" aria-valuemin="0" aria-valuemax="100"
                                    style="width: 0%">&nbsp;0%
                                </div>
                            </div>
                            <div class="form-group" id="grid">
                                <button id="addLecture" type="button" class="btn btn-primary">Add Lecture</button>

                            </div>


                        </form>
                    </div>

                </div>
                <!----edit lec pop up----->
                <div id="myModal_lec_edit" class="modallll">
                    <!-- Modal content -->
                    <div class="modal-contenttt">
                        <span class="close_lec_edit" id="close_lec_edit">&times;</span>
                        <form>

                            <div class="form-group">
                                <label for="inputEmail4">lecture title</label>
                                <input type="text" class="form-control" id="lec_name_edit" placeholder="عنوان المحاضره">
                                <p class="validation" id="lec_name_validation_edit">Lecture title Name must be
                                    filled out
                                </p>
                            </div>
                            <div class="form-group">
                                <label for="inputAddress">Lecture Description</label>
                                <input type="text" class="form-control" id="lec_desc_edit" placeholder="وصف المحاضرة">
                                <p class="validation" id="lec_description_validation_edit">Lecture Description must
                                    be
                                    filled out</p>
                            </div>

                            <div class="form-group">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="false"
                                        id="checkScreenShot_edit">
                                    <label class="form-check-label" for="flexCheckDefault">
                                        يمكن تصوير الشاشة ؟
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="false" id="checkfree_edit">
                                    <label class="form-check-label" for="flexCheckDefault">
                                        الفديو مجاني ؟
                                    </label>
                                </div>

                            </div>

                            <div class="form-group" id="grid">
                                <button id="editLecture" type="button" class="btn btn-primary">Update Lecture</button>
                            </div>



                        </form>
                    </div>

                </div>
                <!----delete lec pop up----->
                <div id="myModal_lec_delete">
                    <!-- Modal content -->
                    <div class="modal-contentttt">
                        <span class="close_lec_delete" id="close_lec_delete">&times;</span>
                        <form>

                            <h1>Delete Lecture</h1>
                            <p>Are you sure you want to delete this Lecture?</p>

                            <div class="clearfix">
                                <button type="button" id="cancel" class="cancelbtn">Cancel</button>
                                <button type="button" id="delete" class="deletebtn">Delete</button>
                            </div>

                        </form>
                    </div>

                </div>
                <!----preview video pop up----->
                <div id="myModal_video" class="modalll">
                    <!-- Modal content -->
                    <div class="modal-contenttt_prev">
                        <span class="close_video" id="close_video">&times;</span>
                        <div class="container">
                            <h1 id="video_name"></h1>
                            <p id="video_desc"></p>
                            <div id="video_Div">

                            </div>
                        </div>

                    </div>

                </div>
                <!----add lec exit comfrim  pop up----->
                <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel"
                    aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                are you sure you want to exit ?

                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-primary" id="exit_lec">EXIT</button>
                                <button type="button" class="btn btn-blue" data-bs-dismiss="modal">Continue</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!----add pdf pop up----->
                <div id="myModal_pdf" class="add_modal_pdf">
                    <!-- Modal content -->
                    <div class="modal-content_pdf">
                        <span class="close_pdf" id="close_pdf" data-bs-toggle="modal"
                            data-bs-target="#exampleModalpdf">&times;</span>
                        <form>

                            <div class="form-group" style="text-align:center ;">
                                <label for="inputEmail4">Pdf title</label>
                                <input type="text" class="form-control" id="pdf_name" placeholder="عنوان المستند">
                                <p class="validation" id="pdf_name_validation">Pdf Name must be filled out
                                </p>
                            </div>
                            <div class="form-group">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="false" id="checkPdfDownloaf">
                                    <label class="form-check-label" for="flexCheckDefault">
                                        هل يمكن للطالب تحميل الملف ؟
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="true" id="CheckPdfPrev">
                                    <label class="form-check-label" for="flexCheckDefault">
                                        هل الملف مجاني للطلاب الغير مسجلين بالكورس ؟
                                    </label>
                                </div>
                            </div>
                            <div>
                                <div id="drop_zone_pdf">Drop Files Here</div>
                                <div id="flexa7a" class="flex">
                                    <h4 id="pagesss" style="text-align: center;"></h4> : عدد الصفح
                                </div>

                                <label class="btn btn-block btn-info">
                                    Browse&hellip; <input id="browse_pdf" type="file" style="display: none;"
                                        accept=".pdf">
                                </label>
                            </div>
                            <p class="validation" id="pdf_validation">You didn't choose a pdf to upload</p>
                            <div id="progress-container_pdf" class="progress">
                                <div id="progress_pdf"
                                    class="progress-bar progress-bar-info progress-bar-striped active"
                                    role="progressbar" aria-valuenow="46" aria-valuemin="0" aria-valuemax="100"
                                    style="width: 0%">&nbsp;0%
                                </div>

                            </div>

                            <div class="form-group" id="grid">
                                <button id="addPdf" type="button" class="btn btn-primary">Add Pdf</button>
                            </div>



                        </form>
                    </div>

                </div>
                <!----add pdf exit comfrim  pop up----->
                <div class="modal fade" id="exampleModalpdf" tabindex="-1" aria-labelledby="exampleModalLabel"
                    aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLabelpdf">Exit</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                Are you sure you want to exit ?

                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-primary" id="exit_pdf">EXIT</button>
                                <button type="button" class="btn btn-blue" data-bs-dismiss="modal">Continue</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!----edit pdf pop up----->
                <div id="myModal_pdf_edit" class="edit_modal_pdf">
                    <!-- Modal content -->
                    <div class="modal-content_pdf">
                        <span class="close_pdf_edit" id="close_pdf_edit">&times;</span>
                        <form>

                            <div class="form-group" style="text-align:center ;">
                                <label for="inputEmail4">Pdf title</label>
                                <input type="text" class="form-control" id="pdf_name_edit" placeholder="عنوان المستند">
                                <p class="validation" id="pdf_name_validation_edit">Pdf Name must be filled out
                                </p>
                            </div>
                            <div class="form-group">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="false"
                                        id="checkPdfDownloaf_edit">
                                    <label class="form-check-label" for="flexCheckDefault">
                                        هل يمكن للطالب تحميل الملف ؟
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="true" id="CheckPdfPrev_edit">
                                    <label class="form-check-label" for="flexCheckDefault">
                                        هل الملف مجاني للطلاب الغير مسجلين بالكورس ؟
                                    </label>
                                </div>
                            </div>


                            <div class="form-group" id="grid">
                                <button type="button" id="editpdf" class="btn btn-primary">Update Lecture</button>
                            </div>



                        </form>
                    </div>

                </div>

                <!----delete pdf pop up----->
                <div id="myModal_pdf_delete">
                    <!-- Modal content -->
                    <div class="modal-contentttt">
                        <span class="close_pdf_delete" id="close_pdf_delete">&times;</span>
                        <form>

                            <h1>Delete pdf</h1>
                            <p>Are you sure you want to delete this pdf?</p>

                            <div class="clearfix">
                                <button type="button" id="cancel_pdf" class="cancelbtn_pdf">Cancel</button>
                                <button type="button" id="delete_pdf" class="deletebtn_pdf">Delete</button>
                            </div>

                        </form>
                    </div>

                </div>

                <!----add quiz pop up----->


                <!----add quiz pop up----->
                <div id="myModal_quizzz" class="add_modal_quizzz">
                    <!-- Modal content -->
                    <div class="modal-content_quizzz">
                        <span class="close_quizzz" id="close_quizzz" data-bs-toggle="modal"
                            data-bs-target="#exampleModalquiz">&times;</span>
                        <form id="quiz_elements">


                            <div class="form-group" style="text-align:center ;">
                                <label for="inputEmail4">quiz title</label>
                                <input type="text" class="form-control" id="quiz_name" placeholder="عنوان الامتحان">
                                <p class="validation" id="quiz_name_validation">Quiz title must be filled out
                                </p>
                            </div>
                            <div class="form-group">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="false" id="enroll">
                                    <label class="form-check-label" for="flexCheckDefault">
                                        هل الامتحان يتطلب التسجيل بالكورس ؟
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="true" id="repeat">
                                    <label class="form-check-label" for="flexCheckDefault">
                                        هل يمكن اعادة الامتحان ؟
                                    </label>
                                </div>

                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="true" id="time">
                                    <label class="form-check-label" for="flexCheckDefault">
                                        هل الامتحان وقت معين ؟
                                    </label>
                                </div>
                            </div>


                            <div class="form-group" id="quiz_time_div" style="text-align:center ;">
                                <label for="inputEmail4">Quiz time</label>
                                <input type="text" class="form-control" id="quiz_time" placeholder="الوقت بالدقايق">
                                <p class="validation" id="quiz_time_validation">Quiz Time must be filled out
                                </p>

                            </div>

                            <div class="form-group" id="grid">
                                <button type="button" id="Next_quiz" class="btn btn-primary">Next</button>
                            </div>


                        </form>
                    </div>

                </div>

                <!----add quiz exit comfrim  pop up----->
                <div class="modal fade" id="exampleModalquiz" tabindex="-1" aria-labelledby="exampleModalLabel"
                    aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLabelpdf">Exit</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                Are you sure you want to exit ?

                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-primary" id="exit_quiz">EXIT</button>
                                <button type="button" class="btn btn-blue" data-bs-dismiss="modal">Continue</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!----Preview quiz  pop up----->
                <div id="preview_quiz_info" class="preview_quiz_info">
                    <div class="info_box">
                        <div class="info_title">
                            <span>Some rule of this quiz</span>
                        </div>
                        <div class="info_list">
                            <div class="info" id="quiz_info_time">1. You will have only <span
                                    id="quiz_time_prev">10</span> minutes to finish
                                this
                                Quiz</div>
                            <div class="info">2. You can't select any option once time goes off</div>
                            <div class="info">3. You will get points basis of your correct answer </div>
                        </div>
                        <div class="buttons">
                            <button class="quit" id="quit_quiz">Later</button>
                            <button class="resteart" id="start_quiz">Start</button>
                        </div>
                    </div>
                </div>
                <div id="preview_quiz_box" class="preview_quiz_box">
                    <div class="quiz_box">
                        <header>
                            <div class="title" id="quiz_prev_title">Quiz title</div>
                            <div class="timer" id="quiz_prev_timer">
                                <div class="time_text">Time Left</div>
                                <div class="time_min"><span id="time_left">9</span>min</div>
                            </div>
                        </header>
                        <section>
                            <div class="que_text">
                                <span>what's first developer ?</span>
                            </div>
                            <div class="option_list">
                                <div class="option">
                                    <span class="option_1"> fdfds</span>
                                </div>
                                <div class="option">
                                    <span class="option_2"> sdfdsf</span>
                                </div>
                                <div class="option">
                                    <span class="option_3"> ssadsvxz</span>
                                </div>
                                <div class="option">
                                    <span class="option_4"> gfdgfdgd</span>
                                </div>
                            </div>
                        </section>
                        <footer>
                            <div class="total_que">
                                <span>
                                    <p id="current_quiz_count">1</p>of<p id="total_count">5</p> Questions
                                </span>
                            </div>
                            <div class="buttons">
                                <button class="quit" id="quit_score">Finish</button>
                                <button class="resteart" id="next_btn_quiz">Next</button>
                            </div>
                        </footer>
                    </div>
                </div>
                <div id="preview_quiz_res" class="preview_quiz_res">
                    <div class="result_box">
                        <div class="icon">
                            <span class="material-symbols-sharp">workspace_premium</span>
                        </div>
                        <div class="complete_text">You've Complete the Quiz!</div>
                        <div class="score_text">
                            <span>Congratlations you got <p id="your_Score">2</p> Out of <p id="total_score">5</p>
                            </span>
                        </div>
                        <div class="buttons">
                            <button class="quit" id="quiz_end">End</button>
                        </div>
                    </div>
                </div>

                <!----edit quiz pop up----->
                <div id="myModal_quiz_edit" class="edit_modal_quiz">
                    <!-- Modal content -->
                    <div class="modal-content_quizzz">
                        <span class="close_quiz_edit" id="close_quiz_edit">&times;</span>
                        <form id="quiz_edit_elements">


                            <div class="form-group" style="text-align:center ;">
                                <label for="inputEmail4">quiz title</label>
                                <input type="text" class="form-control" id="quiz_name_edit"
                                    placeholder="عنوان الامتحان">
                                <p class="validation" id="quiz_name_validation_edit">Quiz title must be filled out
                                </p>
                            </div>
                            <div class="form-group" id="quiz_time_div_edit" style="text-align:center ;">
                                <label for="inputEmail4">Quiz time</label>
                                <input type="text" class="form-control" id="quiz_time_edit"
                                    placeholder="الوقت بالدقايق">
                                <p class="validation" id="quiz_time_validation_edit">Quiz Time must be filled out
                                </p>
                            </div>
                            <div class="form-group">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="false" id="enroll_edit">
                                    <label class="form-check-label" for="flexCheckDefault">
                                        هل الامتحان يتطلب التسجيل بالكورس ؟
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="true" id="repeat_edit">
                                    <label class="form-check-label" for="flexCheckDefault">
                                        هل يمكن اعادة الامتحان ؟
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="true" id="time_edit">
                                    <label class="form-check-label" for="flexCheckDefault">
                                        هل الامتحان وقت معين ؟
                                    </label>
                                </div>
                            </div>




                            <div class="form-group" id="flex_between">
                                <button type="button" id="edit_questions" class="btn btn-primary">Edit
                                    Questions</button>
                                <button type="button" id="update_quiz" class="btn btn-primary">Save</button>
                            </div>


                        </form>
                    </div>



                </div>
                <!----delete quiz pop up----->
                <div id="myModal_quiz_delete">
                    <!-- Modal content -->
                    <div class="modal-contentttt">
                        <span class="close_quiz_delete" id="close_quiz_delete">&times;</span>
                        <form>

                            <h1>Delete Quiz</h1>
                            <p>Are you sure you want to delete this Quiz?</p>

                            <div class="clearfix">
                                <button type="button" id="cancel_quiz" class="cancelbtn_quiz">Cancel</button>
                                <button type="button" id="delete_quiz" class="deletebtn_quiz">Delete</button>
                            </div>

                        </form>
                    </div>

                </div>



                <div id="Home" class="tabcontent">


                    <div class="media_list_lec" id="video_list">
                        <h2 id="emptylec" class="empty">لا يوجد محاضرات الرجاء قم بأضافة محاضرات </h2>
                    </div>
                    <div id="swapButtons" class="two_buttons">
                        <button id="cancelSwap" class="btn btn-primary">Cancel</button>
                        <button id="saveSwap" class="btn btn-primary">Save</button>
                    </div>

                </div>
                <div id="News" class="tabcontent">

                    <div class="media_list_lec" id="pdf_list">
                        <h2 id="emptypdf" class="empty">لا يوجد مستندات الرجاء قم بأضافة مستند </h2>
                    </div>




                    <ul class="breadcrumbb centerr" id="pdf_Arrow">
                        <li><a href="#" id="current_page_pdf"></a></li>
                        <li><a href="#" class="active" id="pages_pdf"></a></li>
                    </ul>
                    <nav class="pigi" id="pdf_pigi">
                        <div class="pagination">
                            <li class="page-item">
                                <button class="page-link " id="prev-btn_pdf"><span class="material-symbols-sharp">
                                        arrow_back
                                    </span></button>
                            </li>
                            <li class="page-item">
                                <button class="page-link" id="next-btn_pdf"><span
                                        class="material-symbols-sharp">arrow_forward</span></button>
                            </li>
                        </div>
                    </nav>
                </div>
                <div id="Contact" class="tabcontent">

                    <div class="media_quiz_lec" id="quiz_list">
                        <h2 id="emptyquiz" class="empty">لا يوجد امتحان الرجاء قم بأضافة امتحان </h2>
                    </div>




                    <ul class="breadcrumbb centerr" id="quiz_Arrow">
                        <li><a href="#" id="current_page_quiz"></a></li>
                        <li><a href="#" class="active" id="pages_quiz"></a></li>
                    </ul>
                    <nav class="pigi" id="quiz_pigi">
                        <div class="pagination">
                            <li class="page-item">
                                <button class="page-link " id="prev-btn_quiz"><span class="material-symbols-sharp">
                                        arrow_back
                                    </span></button>
                            </li>
                            <li class="page-item">
                                <button class="page-link" id="next-btn_quiz"><span
                                        class="material-symbols-sharp">arrow_forward</span></button>
                            </li>
                        </div>
                    </nav>
                </div>

            </div>





        </main>
        <!----END OF course----->

        <!---- start OF wallet ---->
        <main id="wallet">
            <button id="menu-btn_snow" class="menu-btn_snow">
                <span class="material-symbols-sharp">menu</span>
            </button>
            <div class="col-lg-12 grid-margin stretch-card">
                <div class="card">
                    <div class="card-body">
                        <h4 class="card-title">تحويلات المحفطة</h4>
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>المبلغ</th>
                                        <th>التاريخ</th>
                                        <th>الوصف</th>
                                    </tr>
                                </thead>
                                <tbody id="wallet_rows">

                                </tbody>
                            </table>
                        </div>
                    </div>
                    <a href="#" class="show_more" id="show_more_wallet">Show More</a>
                </div>
            </div>


        </main>
        <!----END OF wallet----->

        <!---- start OF report ---->
        <main id="report"></main>
        <!----END OF report----->

        <!---- start OF settings ---->
        <main id="setting">

            <button id="menu-btn_snow" class="menu-btn_snow">
                <span class="material-symbols-sharp">menu</span>
            </button>
            <div class="list-group list-group-flush account-settings-links mb-2">
                <a class="list-group-item list-group-item-action active" data-toggle="list"
                    href="#account-general">General</a>
                <a class="list-group-item list-group-item-action" data-toggle="list"
                    href="#account-change-password">Change password</a>
                <a class="list-group-item list-group-item-action" data-toggle="list" href="#account-social-links">Team
                    Members</a>
                <a class="list-group-item list-group-item-action" data-toggle="list"
                    href="#account-connections">Connections</a>
                <a class="list-group-item list-group-item-action" data-toggle="list"
                    href="#account-notifications">Notifications</a>
            </div>



            <div class="card overflow-hidden">
                <div class="tab-content">

                    <div class="tab-pane fade active show" id="account-general">


                        <div class="contpiv">
                            <img id="cover_img" src="https://bootdey.com/img/Content/avatar/avatar1.png" alt=""
                                class="d-block ui-w-80">
                            <div class="overlaypiv">
                                <label style="color: white !important; cursor: pointer;" for="cover_edit_img">
                                    <span class="material-symbols-sharp">
                                        photo_camera
                                    </span>
                                </label>
                                <input type="file" id="cover_edit_img" accept="image/*" style="display: none;">
                            </div>
                        </div>


                        <div class="contpiv2">
                            <img id="pp_img" src="https://bootdey.com/img/Content/avatar/avatar1.png" alt=""
                                class="d-block ui-w-80">
                            <div class="overlaypiv2">
                                <label style="color: white !important; cursor: pointer;" for="pp_edit_img">
                                    <span class="material-symbols-sharp">
                                        photo_camera
                                    </span>
                                </label>
                                <input type="file" id="pp_edit_img" accept="image/*" style="display: none;">
                            </div>
                        </div>
                        <hr class="border-lightt m-0">
                        <div class="card-body">
                            <div class="form-group">
                                <label class="form-label">Name</label>
                                <input type="text" class="form-control" id="setting_name" value="">
                                <p class="validation" id="setting_name_valid">Name must be
                                    filled out</p>
                            </div>


                            <div class="form-group">
                                <label class="form-label">Bio</label>
                                <textarea class="form-control" rows="5" id="setting_bio"></textarea>
                                <p class="validation" id="setting_bio_valid">Bio must be
                                    filled out</p>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Phone</label>
                                <input type="tel" class="form-control" id="setting_phone" maxlength="11" type="number"
                                    required />
                                <p class="validation" id="setting_phone_valid">Phone number must be
                                    filled out</p>
                                <p class="validation" id="setting_phone2_valid">تأكد من كتابة الرقم بشكل صحيح</p>
                            </div>
                            <div class="text-right mt-3">
                                <button type="button" class="btn btn-primary" id="update_info_setting">Save
                                    changes</button>&nbsp;
                            </div>
                        </div>

                    </div>

                    <div class="tab-pane fade" id="account-change-password">
                        <div class="card-body pb-2">

                            <div class="form-group" id="old_form">
                                <label class="form-label">Old password</label>
                                <input type="password" id="old_pass" class="form-control" autocomplete="new-password">
                            </div>

                            <div class="form-group">
                                <label class="form-label">New password</label>
                                <input type="password" id="new_pass" class="form-control" autocomplete="new-password">
                            </div>

                            <div class="form-group">
                                <label class="form-label">Repeat new password</label>
                                <input type="password" id="new_pass_cofrm" class="form-control"
                                    autocomplete="new-password">
                            </div>
                            <p class="validation" id="pass_old"> Wrong Password </p>
                            <p class="validation" id="pass_valid"> Password must be filled out </p>
                            <p class="validation" id="pass2_valid"> Password must match </p>
                            <p class="validation" id="pass3_valid"> Minmum passowrd length 8 </p>
                            <div class="text-right mt-3">
                                <button type="button" class="btn btn-primary" id="update_paswword">Save
                                    changes</button>&nbsp;
                            </div>
                        </div>
                    </div>

                    <div class="tab-pane fade" id="account-info">



                    </div>

                    <div class="tab-pane fade" id="account-social-links">
                        <div class="tab-content">
                            <div class="list-group list-group-flush account-settings-links mb-2">
                                <a class="list-group-item list-group-item-action active" data-toggle="list"
                                    href="#Team_members">Team Members</a>
                                <a class="list-group-item list-group-item-action" data-toggle="list"
                                    href="#Add_member">Add Assistant</a>
                            </div>
                            <div class="tab-pane fade active show" id="Team_members">
                                <div class="media_list_lec" id="listingTeam">
                                    <div class="media_lec">
                                        <img class="media-object_lec"
                                            src="https://bootdey.com/img/Content/avatar/avatar1.png" alt="Sample photo">
                                        <div class="media-body_lec">
                                            <h3 class="media-heading_lec">Assistant name</h3>
                                        </div>
                                        <ul class="list-inline m-0">
                                            <li class="list-inline-item">
                                                <label class="switch">
                                                    <input type="checkbox">
                                                    <span class="slider round"></span>
                                                </label>
                                            </li>
                                        </ul>

                                    </div>


                                </div>
                            </div>
                            <div class="tab-pane fade" id="Add_member">

                                <div class="card-body pb-2">

                                    <div class="form-group">
                                        <label class="form-label">Email</label>
                                        <input type="text" class="form-control" id="asst_email">
                                        <p class="validation" id="asst_email_valid"> Email must be filled out </p>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Name</label>
                                        <input type="text" class="form-control" id="asst_name">
                                        <p class="validation" id="asst_name_valid"> name must be filled out </p>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Whatsapp</label>
                                        <input type="text" class="form-control" id="asst_phone">
                                        <p class="validation" id="asst_phone_valid"> Whatsapp must be filled out </p>
                                        <p class="validation" id="asst_phone2_valid">الرجاء التأكد من كتابة الاسم بشكل
                                            صحيح </p>
                                    </div>
                                    <div class="text-right mt-3">
                                        <button type="button" class="btn btn-primary" id="create_asst">Create
                                            Acount</button>&nbsp;
                                    </div>


                                </div>

                            </div>
                        </div>
                    </div>

                    <div class="tab-pane fade" id="account-connections">
                        <div class="card-body" id="con_google">
                            <hr class="border-lightt m-0">
                            <button type="button" class="btn btn-instagram" disabled>Connected to
                                <strong>Google</strong></button>
                        </div>

                        <div class="card-body" id="con_facebook">
                            <hr class="border-lightt m-0">
                            <hr class="border-lightt m-0">
                            <button type="button" class="btn btn-facebook" disabled>Connected to
                                <strong>Facebook</strong></button>

                        </div>

                        <div class="card-body" id="btn_google">
                            <hr class="border-lightt m-0">
                            <div id="buttonDiv">
                                <button type="button" id="connectGo" class="btn btn-instagram">Connect to
                                    <strong>Google</strong></button>
                            </div>

                        </div>
                    </div>

                    <div class="tab-pane fade" id="account-notifications">


                        <div class="card-body pb-2">
                            <h6 class="mb-4">Notifications</h6>

                            <div class="form-group">
                                <label class="form-label right_label">ارسال اشعار</label>
                                <textarea type="text" class="form-control" id="noti_input"></textarea>
                                <p class="validation" id="noti_valid">Notification input must be filled out</p>
                            </div>
                            <div class="text-right mt-3">
                                <button type="button" id="send_noti" class="btn btn-primary">Send
                                    Notifications</button>&nbsp;
                            </div>
                        </div>
                    </div>

                </div>


            </div>





        </main>
        <!----END OF settings----->

    </div>




    <div class="loader-wrapper">
        <span class="loader"><span class="loader-inner"></span></span>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.min.js"
        integrity="sha384-ODmDIVzN+pFdexxHEHFBQH3/9/vQ9uori45z4JjnFsRydbmQbmL5t1tQ0culUzyK"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js"
        integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
        crossorigin="anonymous"></script>
    <script src="javascript/dark-toggle.js"></script>

    <script src="javascript/home.js"></script>
    <script type="module" src="javascript/chart.js"></script>
    <script type="text/javascript" src="javascript/vimeo-upload-js.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
    <script src="https://mozilla.github.io/pdf.js/build/pdf.js"></script>
    <script src="https://github.com/devongovett/pdfkit/releases/download/v0.10.0/pdfkit.standalone.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.12.313/pdf.min.js"></script>
    <script src="https://unpkg.com/pdf-lib@1.4.0/dist/pdf-lib.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/pdf-lib@1.4.0/dist/pdf-lib.min.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.13.2/themes/smoothness/jquery-ui.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.13.2/jquery-ui.min.js"></script>

    
    <script type="module">

        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
        import {
            getAuth,
            createUserWithEmailAndPassword,
            signInWithEmailAndPassword,
            signOut,
            GoogleAuthProvider,
            signInWithRedirect,
            getRedirectResult,
            signInWithPopup,
            deleteUser,
            FacebookAuthProvider,
            onAuthStateChanged,
            reauthenticateWithCredential,
            EmailAuthProvider,
            updatePassword,
            linkWithCredential,
        } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js";
        import { getFirestore, collection, where, getDocs, doc, query, getDoc, addDoc, setDoc, updateDoc, deleteDoc, orderBy, limit, startAt as startAtt, startAfter as startAfterr, endAt as endAtt } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js";
        import { getDatabase, set, ref, update, child, get, orderByKey, endAt, orderByChild, limitToFirst, limitToLast, query as squery, startAt, startAfter, } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js";
        import { getStorage, ref as sRef, uploadBytes, getDownloadURL, uploadBytesResumable } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-storage.js";
        import { getFunctions, httpsCallable } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-functions.js"
        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCHMPzqBiDTGmOA1T2DavAaludCOiPb2Qk",
            authDomain: "light-area-ee9d2.firebaseapp.com",
            databaseURL: "https://light-area-ee9d2-default-rtdb.firebaseio.com",
            projectId: "light-area-ee9d2",
            storageBucket: "light-area-ee9d2.appspot.com",
            messagingSenderId: "327935716338",
            appId: "1:327935716338:web:712ee051f28488a3ce196b",
            measurementId: "G-EM9YV97BK7"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth();
        const db = getFirestore(app);
        const storage = getStorage();
        const database = getDatabase(app);
        const functions = getFunctions();
        const logout_btn = document.querySelector("#logout-btn");
        let course_card_perpage = 3;
        let current_corse_page = 1;
        let video_per_page = 4;
        let current_video_page = 1;
        let pdf_per_page = 4;
        let current_pdf_page = 1;
        let quiz_per_page = 4;
        let current_quiz_page = 1;
        var current_choise_index = 1;
        var question_number = 1;
        var quiz_data = { courseid: "", name: "", repeatbool: false, timerbool: false, time: 0, freebool: false, date: new Date(), examtake: 0, quizcount: 0 };
        var question_arr = [];
        var quiz_preview_data = { time: "", count: "", name: "", repeat: false, free: false, timer: false }
        var question_arr_prev = [];
        var current_choise_index_edit;
        const div_updates = document.getElementById("updates");
        var show_more_index = 0;

        // ======================== functions ===============================================

        // ======================== Home functions ===============================================

        // in add course form it validtae the date to today
        function datevalid() {
            var dtToday = new Date();

            var month = dtToday.getMonth() + 1;
            var day = dtToday.getDate();
            var year = dtToday.getFullYear();
            if (month < 10)
                month = '0' + month.toString();
            if (day < 10)
                day = '0' + day.toString();

            var maxDate = year + '-' + month + '-' + day;


            document.getElementById("expiredate").setAttribute("min", maxDate);

        }
        datevalid();
        // passin a query it return an arry of object with sanpshot values  
        function retrivequiers(queryy) {
            async function geta() {

                let arr = []
                const querySnapshott = await getDocs(queryy);
                querySnapshott.forEach((doc) => {
                    // doc.data() is never undefined for query doc snapshots

                    arr.push(doc.data());
                });
                return arr;
            }
            function getb() {
                return new Promise(function (resolve) {
                    resolve(geta());
                });
            };

            return getb();
        }
        function retrivequiers2(queryy) {
            async function geta() {

                let arr = []
                const querySnapshott = await getDocs(queryy);
                const lastVisible = querySnapshott.docs[querySnapshott.docs.length - 1];
                sessionStorage.setItem("last_doc", JSON.stringify(lastVisible));
                querySnapshott.forEach((doc) => {
                    // doc.data() is never undefined for query doc snapshots

                    arr.push(doc.data());
                });
                return arr;
            }
            function getb() {
                return new Promise(function (resolve) {
                    resolve(geta());
                });
            };

            return getb();
        }

        //returent current user id

        function userUid() {
            return new Promise((resolve, reject) => {
                const userr = onAuthStateChanged(auth, (user) => {
                    if (user) {
                        // User is signed in, see docs for a list of available properties
                        // https://firebase.google.com/docs/reference/js/firebase.User

                        const uidd = user.uid;
                        //////console.log(uidd);
                        resolve(uidd);
                    } else {
                        // User is signed out
                        alert("الرجاء قم بتسجيل الدخول مره اخري");
                        location.replace("../Login.html");

                    }
                    userr();
                });
            })

        }
        const user_uid = await userUid();
        //console.log(user_uid);
        // set user data in home tab

        async function getUserData(id) {
            const docRef = doc(db, "users", id);
            const docSnap = await getDoc(docRef);
            if (docSnap.exists()) {
                const listofsubs = docSnap.data().totalSubscribers;
                const followers = docSnap.data().listSubscribers.length;
                document.getElementById("income").innerHTML = docSnap.data().wallet;
                document.getElementById("sub").innerHTML = docSnap.data().totalSubscribers;
                document.getElementById("follow").innerHTML = followers;
                document.getElementById("name").innerHTML = docSnap.data().name;
                document.getElementById("profile-img").src = docSnap.data().ppUrl;
                //settings data
                var user = docSnap.data();
                document.getElementById("cover_img").src = user.coverUrl;

                if (user.ppUrl == "") {
                    document.getElementById("pp_img").src = "img/pp.jpg";
                }
                else {
                    document.getElementById("pp_img").src = user.ppUrl;
                }
                document.getElementById("setting_name").value = user.name;
                document.getElementById("setting_bio").value = user.bio;
                document.getElementById("setting_phone").value = user.contactPhone;
                const Assistant_query = query(collection(db, "users"), where("managerId", "==", id), where("type", "==", "assistant"));
                let Assistant_Data = await retrivequiers(Assistant_query);
                //console.log(Assistant_Data);

                // setting data team members 
                var assthtml = "";
                if (Assistant_Data.length == 0) {
                    assthtml = "<h2 class=\"center emptyteam\"> لا يوجد لديك مساعدين قم بأضافة مساعدين الان  </h2>"
                }
                else {
                    Assistant_Data.forEach((asst) => {

                        assthtml += " <div class=\"media_lec\">"
                        if (asst.ppUrl == "") {
                            assthtml += '<img class=\"media-object_lec\" src=\"https://bootdey.com/img/Content/avatar/avatar1.png\" alt=\"Sample photo\">'
                        }
                        else { assthtml += '<img class=\"media-object_lec\" src=\"' + asst.coverUrl + '\" alt=\"Sample photo\">' }
                        assthtml += '<div class=\"media-body_lec\">'
                        assthtml += '<h3 class=\"media-heading_lec\">' + asst.name + '</h3>'
                        assthtml += '</div>'
                        assthtml += '<ul class=\"list-inline m-0\">'
                        assthtml += '<li class=\"list-inline-item\">'
                        if (asst.active == true) {
                            assthtml += '<li class=\"list-inline-item\"><label class=\"switch\"><input type=\"checkbox\" class="active_asst" id="asst_act"   onchange=\"active_asst(\'' + asst.id + '\')\" checked><span class=\"slider round\"></span></label>'
                        }
                        else {
                            assthtml += '<li class=\"list-inline-item\"><label class=\"switch\"><input type=\"checkbox\" class="active_asst" id="asst_act"   onchange=\"active_asst(\'' + asst.id + '\')\" ><span class=\"slider round\"></span></label>'
                        }
                        assthtml += '</li>'
                        assthtml += '</ul>'
                        assthtml += "</div>"

                    })

                }
                document.getElementById("listingTeam").innerHTML = assthtml;

                // setting connections
                if (user.googleId == "") {

                    document.getElementById("btn_google").style.display = "block";
                    document.getElementById("con_google").style.display = "none";
                }
                else {
                    document.getElementById("btn_google").style.display = "none";
                    document.getElementById("con_google").style.display = "block";
                }
                if (user.facebookId == "") {

                    document.getElementById("con_facebook").style.display = "none";
                }
                else {

                    document.getElementById("con_facebook").style.display = "block";
                }
                if (user.pass = "") {
                    document.getElementById("old_pass").style.display = "none";
                    document.getElementById("old_form").style.display = "none";
                }
                else {
                    document.getElementById("old_pass").style.display = "block";
                    document.getElementById("old_form").style.display = "block";
                }
            }
            else {
                // doc.data() will be undefined in this case
                //////console.log("No such document!");
            }

            //wallet 
            const wallet_query = query(collection(db, "users", id, "transactions"), orderBy("date", "desc"), limit(10));
            let wallet_data = await retrivequiers2(wallet_query);
            var tr = "";

            console.log(wallet_data.length);
            console.log(wallet_data);
            if (wallet_data.length < 10) {
                document.getElementById("show_more_wallet").style.display = "none !important"
            }
            wallet_data.forEach((row) => {
                tr += "<tr>"
                var date = toDateTime(row.date.seconds);
                date = formatDate(date);
                if (row.amount < 0) {
                    tr += "<td class=\"text-danger\"> " + row.amount + "<span>Egp<span> <i class=\"fa fa-arrow-down\"></i></td>"
                } else {
                    tr += "<td class=\"text-success\"> " + row.amount + "<span>Egp<span> <i class=\"fa fa-arrow-up\"></i></td>"
                }
                tr += "<td>" + date + "</td>"
                tr += "<td>" + row.desc + "</td>"
                tr += "</tr>"


            })
            document.getElementById("wallet_rows").innerHTML = tr;
        }

        await getUserData(user_uid);


        //logout
        logout_btn.addEventListener('click', () => {
            signOut(auth).then(() => {
                // Sign-out successful.
                location.replace("../Login.html");
            }).catch((error) => {
                // An error happened.
            });
        })

        // get the first 30 notfictions 
        const dbRef = ref(getDatabase());
        const recentPostsRef = query(ref(database, `notifications/${user_uid}`), orderByKey(), limitToLast(30));
        get(recentPostsRef).then((snapshot) => {
            var arr = []
            var notifi = "";
            show_more_index += 5;

            if (snapshot.exists()) {

                snapshot.forEach((doc) => {
                    arr.push(doc.val());


                });
                // console.log(arr);
                arr.reverse();
                arr.forEach((doc) => {
                    var time = "";
                    const currentTimeinMils = new Date().getTime();
                    const diffrenceTime = currentTimeinMils - doc.date;

                    //var date_now = Date.now() - doc.val().date ; 
                    var minutes = Math.floor(diffrenceTime / 60 / 1000);
                    //////console.log(diffrenceTime);

                    //////console.log(minutes);
                    if (minutes < 1) {
                        time = Date.now - doc.date + "sec"
                    }
                    if (minutes > 1 && minutes < 60) {
                        time = minutes + "min"
                    }
                    if (minutes > 60 && minutes < 1440) {
                        time = min_to_hours(minutes);

                    }
                    if (minutes > 1440) {
                        time = hours_to_day(minutes / 60);
                    }
                    //////console.log(time);
                    var div_upd = document.createElement("div");
                    div_upd.setAttribute("class", "update");

                    var div_profile = document.createElement("div");
                    div_profile.setAttribute("class", "profile-photo");

                    var img = document.createElement("img");
                    if (doc.userUrl == "") {
                        let dark = sessionStorage.getItem("dark");
                        img.setAttribute("class", "profileT")
                        if (dark == "false") {
                            img.setAttribute("src", "img/white.png");
                        }
                        else {
                            img.setAttribute("src", "img/white.png");
                        }

                    }
                    else {
                        img.setAttribute("src", doc.userUrl);
                    }
                    div_profile.appendChild(img);
                    // ////console.log(doc.val().userUrl);
                    var message = document.createElement("div");
                    message.setAttribute("class", "message");


                    var prg = document.createElement("p");
                    message.appendChild(prg);
                    prg.innerHTML = doc.textAction;

                    var smll = document.createElement("small");
                    smll.setAttribute("class", "text-muted");
                    smll.innerHTML = time;
                    message.appendChild(smll);
                    div_upd.appendChild(div_profile)
                    div_upd.appendChild(message)

                    div_updates.appendChild(div_upd);
                    sessionStorage.setItem("last_time_id", doc.id)
                })
                /*
                var button= document.createElement("a");
                button.setAttribute("class" , "link_show");
                button.setAttribute("id" , "show_more");
                button.setAttribute("href" , "#");
                button.innerHTML="Show More";
                div_updates.appendChild(button)
                */
            } else {
                //////console.log("No data available");
            }
        }).catch((error) => {
            console.error(error);
        });

        function toDateTime(secs) {
            var t = new Date(1970, 0, 1); // Epoch
            t.setSeconds(secs);
            return t;
        }
        function formatDate(date) {
            var d = new Date(date),
                month = '' + (d.getMonth() + 1),
                day = '' + d.getDate(),
                year = d.getFullYear();

            if (month.length < 2)
                month = '0' + month;
            if (day.length < 2)
                day = '0' + day;

            return [year, month, day].join('-');
        }
        // remove lat dom element child
        function remove_last() {
            div_updates.removeChild(div_updates.lastChild);
        }

        // take min if >60 return hours : min
        function min_to_hours(n) {
            var num = n;
            var hours = (num / 60);
            var rhours = Math.floor(hours);
            var minutes = (hours - rhours) * 60;
            var rminutes = Math.round(minutes);
            return + rhours + " H ";
        }
        // take hours if >24 return D H M 
        function hours_to_day(numberOfHours) {
            var Days = Math.floor(numberOfHours / 24);
            var Remainder = numberOfHours % 24;
            var Hours = Math.floor(Remainder);
            var Minutes = Math.floor(60 * (Remainder - Hours));
            return +Days + "D";
        }

        // ======================== courses functions ==============================================================================================








        // get courser and render it 

        async function rendercourse(page = 1) { 
            const teacher_course_query = query(collection(db, "courses"), where("instructorId", "==", user_uid));
            let courses_Data = await retrivequiers(teacher_course_query);
            var coursehtml = "";


            if (page == 1) {
                document.getElementById("prev-btn").style.visibility = "hidden"
            } else {
                document.getElementById("prev-btn").style.visibility = "visible"
            }
            console.log(page);
            console.log(await numberofpage());
            if (page >= await numberofpage()) {
                document.getElementById("next-btn").style.visibility = "hidden"
            } else {

                document.getElementById("next-btn").style.visibility = "visible"
            }



            courses_Data.filter((row, index) => {
                let start = (current_corse_page - 1) * course_card_perpage;
                let end = (current_corse_page * course_card_perpage);
                if (index >= start && index < end) return true;
            }).forEach(course => {
                if (course.subscribers == undefined) {
                    course.subscribers = 0;
                }



                coursehtml += "<div class=\"rowww\">"
                coursehtml += ' <a href=\"#\"  id=\"opencourse\"  onclick=\" gotolect(\'' + course.id + '\')\"' + 'class=\"course\">'
                coursehtml += "<div class=\"image\">"
                coursehtml += '<img src=\"' + course.picUrl + '\" alt=\"Course image\">'
                if (course.active == false) {
                    coursehtml += "<div class=\"top-left\">مسودة</div>"
                }
                coursehtml += "</div>"
                coursehtml += '<div class=\"courses-text\">'

                coursehtml += '<h2>' + course.courseName + '</h2>'
                coursehtml += '<p>' + course.desc + '</p>'
                coursehtml += '<h4>عدد المحاضرات : ' + "<span class=\"prim\">" + course.videoCount + "</span>" + '</h4>'
                coursehtml += '<div class=\"rating\">'
                coursehtml += '<div class=\"star\">'
                for (var i = 0; i < course.ratingAvg; i++) {
                    coursehtml += "<span class=\"fa fa-star checked\"></span>"
                }
                for (var i = 0; i < (5 - course.ratingAvg); i++) {
                    coursehtml += "<span class=\"fa fa-star \"></span>"
                }

                coursehtml += "</div>"
                coursehtml += '<div class=\"review\">'
                coursehtml += "<p>{  عدد المشتركين : " + "<span class=\"prim\">" + course.subscribers + "</span>" + "}</p>"
                coursehtml += "</div>"
                coursehtml += "</div>"
                coursehtml += "</div>"
                coursehtml += '</a>'
                coursehtml += "</div>"
            })
            if (courses_Data.length > 0)
                document.getElementById("listingCourse").innerHTML = coursehtml;

        }
        await rendercourse(current_corse_page);

        //handle course pages next and prev arrow
        async function previouspage() {
            const teacher_course_query = query(collection(db, "courses"), where("instructorId", "==", user_uid));
            let courses_Data = await retrivequiers(teacher_course_query);
            if (current_corse_page > 1) {
                current_corse_page--;
            }
            await rendercourse(current_corse_page);
        }
        async function nextpage() {
            const teacher_course_query = query(collection(db, "courses"), where("instructorId", "==", user_uid));
            let courses_Data = await retrivequiers(teacher_course_query);
            if ((current_corse_page * course_card_perpage) < courses_Data.length) {
                current_corse_page++;
            }
            await rendercourse(current_corse_page);
        }
        async function numberofpage() {
            const teacher_course_query = query(collection(db, "courses"), where("instructorId", "==", user_uid));
            let courses_Data = await retrivequiers(teacher_course_query);
            return Math.ceil(courses_Data.length / course_card_perpage);
        }
        document.querySelector('#prev-btn').addEventListener('click', await previouspage, false);
        document.querySelector('#next-btn').addEventListener('click', await nextpage, false);

        // get the catgories and set it in the spinner in add course form
        const cargories = query(collection(db, "mainCategory"));
        let catgory_data = await retrivequiers(cargories);

        // passing id of select tag it fills it from array
        function fillselect(selectid, array) {
            var select = document.getElementById(selectid);
            for (var i = 0; i < array.length; i++) {
                var opt = array[i].name;
                var el = document.createElement("option");
                el.textContent = opt;
                el.value = array[i].id;
                select.appendChild(el);
            }
        }
        fillselect("cat_Select", catgory_data);

        // handle sup catgory on change of main catgory
        document.getElementById("cat_Select").addEventListener("change", myFunctionn);
        async function myFunctionn() {
            var selectBox = document.getElementById("cat_Select");
            var selectedValue = selectBox.value;
            var disbaledd = document.getElementById("hidecat");
            var subcatg = document.getElementById("subcat");
            const sub_catg = query(collection(db, "mainCategory", selectedValue, "subCategory"));
            let sub_catgory_data = await retrivequiers(sub_catg);
            // ////console.log(sub_catgory_data);



            if (sub_catgory_data.length > 0) {
                console.log(sub_catgory_data.length);
                var selectBox = document.getElementById("subbcat");
                const select = document.querySelector('select');
                disbaledd.style.display = "block";
                subcatg.style.display = "none";
                var i, L = selectBox.options.length - 1;
                for (i = L; i >= 0; i--) {
                    selectBox.remove(i);
                }
                disbaledd.style.display = "none";
                subcatg.style.display = "block";
                fillselect("subbcat", sub_catgory_data);
            }
            else {
                var selectBox = document.getElementById("subbcat");
                const select = document.querySelector('select');
                disbaledd.style.display = "block";
                subcatg.style.display = "none";
                var i, L = selectBox.options.length - 1;
                for (i = L; i >= 0; i--) {
                    selectBox.remove(i);
                }
            }
        }

        //vildate course form 
        function validateForm() {
            var checkdata = false;
            //inputs
            const course_name = document.getElementById("course_name");
            const course_price = document.getElementById("course_price");
            const course_desc = document.getElementById("course_desc");
            const course_catg = document.getElementById("cat_Select");
            const course_sub_catg = document.getElementById("subbcat");
            const course_img = document.getElementById("file-uploader");

            // validates 
            const course_name_validation = document.getElementById("course_name_validation");
            const course_price_validation = document.getElementById("price_validation");
            const course_desc_validation = document.getElementById("course_description_validation");
            const course_catg_validation = document.getElementById("catagory_validation");
            const course_sub_catg_validation = document.getElementById("sub_catagory_validation");
            const course_img_validation = document.getElementById("image_catagory_validation");

            if (course_name.value == "") {
                course_name_validation.style.display = "block";
                return false;
            }
            else {
                course_name_validation.style.display = "none";
                checkdata = true;
            }


            if (course_price.value == "") {
                course_price_validation.style.display = "block";
                return false;
            }
            else {
                course_price_validation.style.display = "none";
                checkdata = true;

            }


            if (course_desc.value == "") {
                course_desc_validation.style.display = "block";
                return false;
            }
            else {
                course_desc_validation.style.display = "none";
                checkdata = true;

            }


            if (course_catg.value == "" && course_catg.style.display == "block") {
                course_catg_validation.style.display = "block";
                returnfalse;
            }
            else {
                course_catg_validation.style.display = "none";
                checkdata = true;

            }


            if (course_sub_catg.value == "") {
                course_sub_catg_validation.style.display = "block";
                return false;
            }
            else {
                course_sub_catg_validation.style.display = "none";
                checkdata = true;

            }


            if (course_img.files.length == 0) {
                course_img_validation.style.display = "block";
                return false;
            }
            else {
                course_img_validation.style.display = "none";
                checkdata = true;
            }

            return checkdata;
        }

        // taking check box elment and check its value and marked as checked if value == ture otherwise uncheck
        function CheckBox(element) {
            var check = false

            if (element.checked == true) {
                element.value = true;
            }
            if (element.checked == false) {
                element.value = false;
            }

        }

        //set Data to firestore
        async function upload_img() {
            if (validateForm() == true) {
                document.getElementById("addcourse").disabled = true;
                document.getElementById("close_course_Add").style.display = "none";
                document.getElementById("addcourse").style.cursor = "no-drop";
                const fileSelector = document.getElementById('file-uploader').files[0];
                const pdf_fb_id = doc(collection(db, "courses"));
                var storageRef = sRef(storage, "courses/" + pdf_fb_id.id + "/" + "thumb.jpg");
                const uploadTask = uploadBytesResumable(storageRef, fileSelector);

                // Register three observers:
                // 1. 'state_changed' observer, called any time the state changes
                // 2. Error observer, called on failure
                // 3. Completion observer, called on successful completion
                uploadTask.on('state_changed',
                    (snapshot) => {
                        // Observe state change events such as progress, pause, and resume
                        // Get task progress, including the number of bytes uploaded and the total number of bytes to be uploaded
                        //  ////console.log(snapshot.bytesTransferred);
                        //////console.log(snapshot.totalBytes);
                        updateProgressPdf(snapshot.bytesTransferred / snapshot.totalBytes)

                    },
                    (error) => {

                    },
                    async () => {

                        var chkBox = document.getElementById('checksale');
                        CheckBox(chkBox);
                        var watchtimes = document.getElementById("watchcount").value;
                        var expiredate = document.getElementById("expiredate").value;
                        if (watchtimes == "") {
                            watchtimes = 0;
                        }
                        if (expiredate == "") {
                            expiredate = null;
                        } else {
                            expiredate = new Date(expiredate);
                        }
                        // ////console.log(watchtimes);
                        const download_url = await getDownloadURL(uploadTask.snapshot.ref);
                        const sale = document.getElementById("checksale").value;
                        const course_name = document.getElementById("course_name").value;
                        const course_price = document.getElementById("course_price").value;
                        const course_desc = document.getElementById("course_desc").value;
                        const course_catg = document.getElementById("cat_Select").value;
                        const course_sub_catg = document.getElementById("subbcat").value;
                        const teacher_name = document.getElementById("name").innerHTML;
                        const user_uid = await userUid();
                        var sale_bool = (sale === "true");
                        const docRef = await setDoc((db, pdf_fb_id), {
                            active: false,
                            categoryId: course_catg,
                            courseName: course_name,
                            desc: course_desc,
                            instructor: teacher_name,
                            instructorId: user_uid,
                            picUrl: download_url,
                            price: parseInt(course_price),
                            subCategoryId: course_sub_catg,
                            canSell: sale_bool,
                            id: pdf_fb_id.id,
                            limitedWatchTimes: parseInt(watchtimes),
                            expireDate: expiredate,
                            videoCount: 0,
                        });

                        alert("تم اضافة الكورس بنجاح");
                        document.getElementById("myModal").style.display = "none";
                        document.getElementById("addcourse").style.cursor = "pointer";
                        document.getElementById("close_course_Add").style.display = "block";
                        document.getElementById("addcourse").disabled = false;




                    }
                );
            }
            else {
                return;
            }

        }
        $(document).on('click', '#addcourse', async function () {
            await upload_img();
            await rendercourse(current_corse_page);
        });

        //active course
        $(document).on('click', '#activeCourse', async function () {
            var course_id = sessionStorage.getItem("course_id");


            $('#loading_spiner').show();
            setTimeout(function () {
                $('#loading_spiner').fadeOut();
                alert("تم تفعيل الكورس");
            }, 5000);

            const active = httpsCallable(functions, 'publishCourse');
            active({ courseId: course_id })

                .then((result) => {
                    // Read result of the Cloud Function.
                    console.log(result);
                    const data = result.data;
                    document.getElementById("activeCourse").style.display="none";


                })
                .catch((error) => {
                    // Getting the Error details.
                    const code = error.code;
                    const message = error.message;
                    const details = error.details;
                    alert("حدث خطاء ما");
                    console.log("error message : ", error);
                });
            var indexs = await numberofpage();
            for (var i = 1 ; i <=indexs ; i++){
                await rendercourse(i);
            }    
           
        })

        //==================== lecture function ============
        // when user choose a certin course it render it's data (videos - pdf -quizes)

        // function that return durtion for a certing lecture video
        async function get_video_durtion(id) {
            return new Promise((resolve, reject) => {
                $.getJSON('https://vimeo.com/api/oembed.json?url=https://vimeo.com/' + id, { format: "json" }, function (data) {
                })
                    .done(function (data) { resolve(data.duration); })
                    .fail(function (jqXHR, textStatus, errorThrown) { resolve("يتم الان معالجة الفديو") })

            });
        }
        $(document).on('click', '.course', async function () {
            current_video_page = 1;
            current_pdf_page = 1;
            current_quiz_page = 1;


            let Course_id = sessionStorage.getItem("lec_id");
            document.getElementById("editCoursee").setAttribute('onclick','edit_course(\''+Course_id +'\')')
            document.getElementById("activeCourse").setAttribute('onclick','active_course(\''+Course_id +'\')')
            document.getElementById("delete_course").setAttribute('onclick','deletecourse(\''+Course_id +'\')')
            const docRef = doc(db, "courses", Course_id);
            const docSnap = await getDoc(docRef);
            if (docSnap.exists()) {
                document.getElementsByClassName("lec_id2")[0].innerHTML = docSnap.data().courseName;
                console.log(docSnap.data().active);
                if(docSnap.data().active==true){
                    document.getElementById("activeCourse").style.display="none";
                }
                if(docSnap.data().active==false && docSnap.data().videoCount == 0){
                    document.getElementById("activeCourse").style.display="none";
                }
                if(docSnap.data().active==false && docSnap.data().videoCount >= 1){
                    document.getElementById("activeCourse").style.display="flex";
                }
            } else {

            }

            await render_pdf(current_pdf_page);
            await renderLec();
            await render_quiz(current_quiz_page);

        });



        // get course lecture data


        // function that return cover img for a certing lecture video

        async function get_img_from_vemio(id) {
            return new Promise((resolve, reject) => {
                $.getJSON('https://vimeo.com/api/oembed.json?url=https://vimeo.com/' + id, { format: "json" }, function (data) {


                })
                    .done(function (data) { resolve(data.thumbnail_url); })
                    .fail(function (jqXHR, textStatus, errorThrown) { resolve("") })

            });
        }

        // convert sec to hours and min 
        function convertHMS(value) {
            const sec = parseInt(value, 10); // convert value to number if it's string
            let hours = Math.floor(sec / 3600); // get hours
            let minutes = Math.floor((sec - (hours * 3600)) / 60); // get minutes
            let seconds = sec - (hours * 3600) - (minutes * 60); //  get seconds
            // add 0 if value < 10; Example: 2 => 02
            if (hours < 10) { hours = "0" + hours; }
            if (minutes < 10) { minutes = "0" + minutes; }
            if (seconds < 10) { seconds = "0" + seconds; }
            return hours + ':' + minutes + ':' + seconds; // Return is HH : MM : SS
        }

        // handle and render lecture videos data preview videos
        async function renderLec(page = 1) {
            let Course_id = sessionStorage.getItem("lec_id");
            const course_videos_query = query(collection(db, "videos"), where("courseId", "==", Course_id), orderBy("sortValue", "asc"));
            let courses_videos_Data = await retrivequiers(course_videos_query);
            console.log(courses_videos_Data);
            var Lechtml = "";


        
            ////console.log(courses_videos_Data);
            if (courses_videos_Data.length == 0) {
                Lechtml += "<h2 class=\"empty\">لا يوجد محاضرات الرجاء قم بأضافة محاضرات </h2>"
                document.getElementById("video_list").innerHTML = Lechtml;

            }
            else {
               for(var i = 0 ; i <= courses_videos_Data.length ; i++ ){
            

                    let arr = courses_videos_Data[i].videoUrl.split("/");
                    
                    var viemo_id = arr[3];
                    var img_url = await get_img_from_vemio(viemo_id);
                    var video_dur = await get_video_durtion(viemo_id);
                    if (video_dur != "يتم الان معالجة الفديو") {
                        video_dur = convertHMS(video_dur);
                    }

                    ////console.log(vide_lenght);
                    ////console.log(img_url)
                   
                    Lechtml += " <div class=\"media_lec\" id=\"swapId\"> "
                    if (img_url == "") {
                        Lechtml += "<div class=\"spinner-border text-danger\" role=\"status\">"
                        Lechtml += "<span class=\"sr-only\">Loading...</span>"
                        Lechtml += "</div>"
                        Lechtml += '<small class=\"word_Stroke\">' + video_dur + '</small>'
                    } else {
                        Lechtml += ' <a href=\"#\"  onclick=\" gottovideo(\'' + courses_videos_Data[i].id + '\')\"' + 'class=\"VideoPopUp\">'
                        Lechtml += '<img class=\"media-object_lec\" src=\"' + img_url + '\" alt=\"Sample photo\">'
                        Lechtml += '<small class=\"text-muted\">' + video_dur + '</small>'
                        Lechtml += '</a>'
                    }
                    Lechtml += '<div class=\"media-body_lec\">'
                    Lechtml += '<h3 class=\"media-heading_lec\">' + courses_videos_Data[i].title + '</h3>'
                    Lechtml += '<p>' + courses_videos_Data[i].desc + '</p>'
                    Lechtml += '</div>'
                    Lechtml += '<ul class=\"list-inline m-0\">'
                    Lechtml += '<li class=\"swap_button\">'
                    Lechtml += '<button class=\"swapBut  btn btn-sm rounded-0\" id="swapp" type=\"button\" title=\"swap\"><span class=\"material-symbols-sharp\">swap_vert</span></button>'
                    Lechtml += '</li>'
                    Lechtml += '<li class=\"list-inline-item\">'
                    Lechtml += '<button class=\"editlec btn btn-success btn-sm rounded-0\" type=\"button\" title=\"Edit\" onclick=\"editvideo(\'' + courses_videos_Data[i].id + '\')\"' + '><span class=\"material-symbols-sharp\">edit</span></button>'
                    Lechtml += '</li>'
                    Lechtml += '<li class=\"list-inline-item\">'
                    Lechtml += '<button class=\"btn btn-danger btn-sm rounded-0\" id="delete_lec" type=\"button\" title=\"Delete\" onclick=\"deletevideo(\'' + courses_videos_Data[i].id + '\')\"' + '><span class=\"material-symbols-sharp\">delete</span></button>'
                    Lechtml += '</li>'
                    Lechtml += '</ul>'
                    Lechtml += "</div>"

                   console.log(Lechtml);
                    document.getElementById("video_list").innerHTML = Lechtml;
                             }

               

            }

        }
        //swap lectures 

     
        // handle and render pdf
        $(document).on('click', '#swap_lec', function () {
        document.getElementById("swapButtons").style.display="flex";
        document.querySelectorAll(".swap_button").forEach(a=>a.style.display = "inline-block");
         jQuery.fn.swap = function (b) {
        // method from: http://blog.pengoworks.com/index.cfm/2008/9/24/A-quick-and-dirty-swap-method-for-jQuery
        b = jQuery(b)[0];
        var a = this[0];
        var t = a.parentNode.insertBefore(document.createTextNode(''), a);
        b.parentNode.insertBefore(a, b);
        t.parentNode.insertBefore(b, t);
        t.parentNode.removeChild(t);
        return this;
    };


    $(".media_lec").draggable({ revert: true, helper: "clone" });

    $(".media_lec").droppable({
        accept: ".media_lec",
        activeClass: "ui-state-hover",
        hoverClass: "ui-state-active",
        drop: function (event, ui) {

            var draggable = ui.draggable, droppable = $(this),
                dragPos = draggable.position(), dropPos = droppable.position();

            draggable.css({
                left: dropPos.left + 'px',
                top: dropPos.top + 'px'
            });

            droppable.css({
                left: dragPos.left + 'px',
                top: dragPos.top + 'px'
            });
            draggable.swap(droppable);
        }
    });
})
        $(document).on('click', '#cancelSwap', async function () {
            var element = document.getElementById("swapId");
             element.classList.remove("ui-draggable");
             element.classList.remove("ui-draggable-handle");
             element.classList.remove("ui-droppable");
            document.getElementById("swapButtons").style.display="none";
           await renderLec();
      
        })
        $(document).on('click', '#saveSwap', async function () {
            var element = document.getElementById("swapId");
             element.classList.remove("ui-draggable");
             element.classList.remove("ui-draggable-handle");
             element.classList.remove("ui-droppable");
            document.getElementById("swapButtons").style.display="none";
           await renderLec();

        })


        async function render_pdf(page = 1) {
            var pdfhtml = "";
            let Course_id = sessionStorage.getItem("lec_id");

            const course_pdf_query = query(collection(db, "courses", Course_id, "pdfs"));
            let courses_pdf_Data = await retrivequiers(course_pdf_query);
            if (page == 1) {
                document.getElementById("prev-btn_pdf").style.visibility = "hidden"
            } else {
                document.getElementById("prev-btn_pdf").style.visibility = "visible"
            }
            if (page > await numberofpagepdf()) {

                document.getElementById("next-btn_pdf").style.visibility = "hidden"
            } else {
                document.getElementById("next-btn_pdf").style.visibility = "visible"
            }

            ////console.log(courses_pdf_Data.length);
            if (courses_pdf_Data.length == 0) {
                pdfhtml += "<h2 class=\"empty\">لا يوجد مستندات الرجاء قم بأضافة مستند </h2>"
                document.getElementById("pdf_list").innerHTML = pdfhtml;
                document.getElementById("pdf_Arrow").style.display = "none";
                document.getElementById("pdf_pigi").style.display = "none";
            }
            else {
                document.getElementById("pdf_Arrow").style.display = "block";
                document.getElementById("pdf_pigi").style.display = "block";
                courses_pdf_Data.filter((row, index_pdf) => {
                    let start_pdf = (current_pdf_page - 1) * pdf_per_page;
                    let end_pdf = (current_pdf_page * pdf_per_page);
                    if (index_pdf >= start_pdf && index_pdf < end_pdf) return true;
                }).forEach(async (pdf) => {
                    if (pdf.thumb == "") {
                        pdfhtml += " <div class=\"media_lec\"> "
                        pdfhtml += '<a href=\"' + pdf.pdfUrl + '\"  target="_blank" class=\"VideoPopUp\">'
                        pdfhtml += '<img class=\"media-object_lec\" src=\"https://firebasestorage.googleapis.com/v0/b/light-area-ee9d2.appspot.com/o/pdf-icon-11549528510ilxx4eex38.png?alt=media&token=dc31df1d-77a6-465b-9ce8-793b5c2e6d3f\" alt=\"Sample photo\">'
                        pdfhtml += '</a>'
                        pdfhtml += '<div class=\"media-body_lec\">'
                        pdfhtml += '<h3 class=\"media-heading_lec\">' + pdf.title + '</h3>'
                        pdfhtml += '</div>'
                        pdfhtml += '<ul class=\"list-inline m-0\">'
                        pdfhtml += '<li class=\"list-inline-item\">'
                        pdfhtml += '<button class=\"editpdf btn btn-success btn-sm rounded-0\" type=\"button\" title=\"Edit\" onclick=\"editPdf(\'' + pdf.id + '\')\"' + '><span class=\"material-symbols-sharp\">edit</span></button>'
                        pdfhtml += '</li>'
                        pdfhtml += '<li class=\"list-inline-item\">'
                        pdfhtml += '<button class=\"btn btn-danger btn-sm rounded-0\" id="delete_pdf" type=\"button\" title=\"Delete\" onclick=\"deletepdf(\'' + pdf.id + '\')\"' + '><span class=\"material-symbols-sharp\">delete</span></button>'
                        pdfhtml += '</li>'
                        pdfhtml += '</ul>'
                        pdfhtml += "</div>"
                    }
                    else {
                        pdfhtml += " <div class=\"media_lec\"> "
                        pdfhtml += '<a href=\"' + pdf.pdfUrl + '\"  target="_blank" class=\"VideoPopUp\">'
                        pdfhtml += '<img class=\"media-object_lec\" src=\"' + pdf.thumb + '\" alt=\"Sample photo\">'
                        pdfhtml += '</a>'
                        pdfhtml += '<div class=\"media-body_lec\">'
                        pdfhtml += '<h3 class=\"media-heading_lec\">' + pdf.title + '</h3>'
                        pdfhtml += '</div>'
                        pdfhtml += '<ul class=\"list-inline m-0\">'
                        pdfhtml += '<li class=\"list-inline-item\">'
                        pdfhtml += '<button class=\"editpdf btn btn-success btn-sm rounded-0\" type=\"button\" title=\"Edit\" onclick=\"editPdf(\'' + pdf.id + '\')\"' + '><span class=\"material-symbols-sharp\">edit</span></button>'
                        pdfhtml += '</li>'
                        pdfhtml += '<li class=\"list-inline-item\">'
                        pdfhtml += '<button class=\"btn btn-danger btn-sm rounded-0\" id="delete_pdf" type=\"button\" title=\"Delete\" onclick=\"deletepdf(\'' + pdf.id + '\')\"' + '><span class=\"material-symbols-sharp\">delete</span></button>'
                        pdfhtml += '</li>'
                        pdfhtml += '</ul>'
                        pdfhtml += "</div>"

                    }
                    document.getElementById("pdf_list").innerHTML = pdfhtml;
                })
                document.getElementById("pages_pdf").innerHTML = await numberofpagepdf();
                if (courses_pdf_Data.length > 0)
                    document.getElementById("current_page_pdf").innerHTML = current_pdf_page;

            }
        }
        async function previouspagepdf() {
            if (current_pdf_page > 1) {
                current_pdf_page--;
            }
            await render_pdf(current_pdf_page);
        }
        async function nextpagepdf() {
            if ((current_pdf_page * pdf_per_page) < courses_pdf_Data.length) {
                current_pdf_page++;
            }
            await render_pdf(current_pdf_page);
        }
        async function numberofpagepdf() {
            let Course_id = sessionStorage.getItem("lec_id");
            const course_pdf_query = query(collection(db, "courses", Course_id, "pdfs"));
            let courses_pdf_Data = await retrivequiers(course_pdf_query);
            return Math.ceil(courses_pdf_Data.length / pdf_per_page);
        }
        document.querySelector('#prev-btn_pdf').addEventListener('click', await previouspagepdf, false);
        document.querySelector('#next-btn_pdf').addEventListener('click', await nextpagepdf, false);

        // handle and render quiz
        async function render_quiz(page = 1) {
            var quizhtml = "";
            let Course_id = sessionStorage.getItem("lec_id");
            const course_quiz_query = query(collection(db, "courses", Course_id, "exams"));
            let courses_quiz_Data = await retrivequiers(course_quiz_query);
            if (page == 1) {
                document.getElementById("prev-btn_quiz").style.visibility = "hidden"
            } else {
                document.getElementById("prev-btn_quiz").style.visibility = "visible"
            }
            if (page > await numberofpagequiz()) {

                document.getElementById("next-btn_quiz").style.visibility = "hidden"
            } else {
                document.getElementById("next-btn_quiz").style.visibility = "visible"
            }

            ////console.log(courses_quiz_Data.length);
            if (courses_quiz_Data.length == 0) {
                quizhtml += "<h2 class=\"empty\">لا يوجد امتحانات الرجاء قم بأضافة امتحان </h2>"
                document.getElementById("quiz_list").innerHTML = quizhtml;
                document.getElementById("quiz_Arrow").style.display = "none";
                document.getElementById("quiz_pigi").style.display = "none";
            }
            else {
                document.getElementById("quiz_Arrow").style.display = "block";
                document.getElementById("quiz_pigi").style.display = "block";
                courses_quiz_Data.filter((row, index_quiz) => {
                    let start_quiz = (current_quiz_page - 1) * quiz_per_page;
                    let end_quiz = (current_quiz_page * quiz_per_page);
                    if (index_quiz >= start_quiz && index_quiz < end_quiz) return true;
                }).forEach(async (quiz) => {

                    const question_quiz_query = query(collection(db, "courses", Course_id, "exams", quiz.id, "questions"), orderBy("sortValue", "asc"));
                    let question_quiz_Data = await retrivequiers(question_quiz_query);
                    var quetions_count = question_quiz_Data.length;
                    quizhtml += " <div class=\"media_lec\"> "
                    quizhtml += ' <a href=\"#\" onclick=\" gottoquiz(\'' + quiz.id + '\')\"' + 'class=\"quizpopup\">'
                    quizhtml += '<img class=\"media-object_lec\" src=\"https://firebasestorage.googleapis.com/v0/b/light-area-ee9d2.appspot.com/o/quiz.png?alt=media&token=6ca9298b-30e9-4244-bf3c-4e993dee30dd\" alt=\"quiz photo\">'
                    quizhtml += '</a>'
                    quizhtml += '<div class=\"media-body_lec\">'
                    quizhtml += '<h3 class=\"media-heading_lec\">' + quiz.name + '</h3>'
                    quizhtml += '<small class=\"text-muted\">' + quetions_count + '<span> : عدد الاسئلة </span></small>'
                    quizhtml += '</div>'
                    quizhtml += '<ul class=\"list-inline m-0\">'
                    quizhtml += '<li class=\"list-inline-item\">'
                    quizhtml += '<button class=\"editquiz btn btn-success btn-sm rounded-0\" type=\"button\" title=\"Edit\" onclick=\"editquiz(\'' + quiz.id + '\')\"' + '><span class=\"material-symbols-sharp\">edit</span></button>'
                    quizhtml += '</li>'
                    quizhtml += '<li class=\"list-inline-item\">'
                    quizhtml += '<button class=\"btn btn-danger btn-sm rounded-0\" id="delete_quiz" type=\"button\" title=\"Delete\" onclick=\"deletequiz(\'' + quiz.id + '\')\"' + '><span class=\"material-symbols-sharp\">delete</span></button>'
                    quizhtml += '</li>'
                    quizhtml += '</ul>'
                    quizhtml += "</div>"


                    document.getElementById("quiz_list").innerHTML = quizhtml;
                })
                document.getElementById("pages_quiz").innerHTML = await numberofpagequiz();
                if (courses_quiz_Data.length > 0)
                    document.getElementById("current_page_quiz").innerHTML = current_quiz_page;

            }
        }
        async function previouspagequiz() {
            if (current_quiz_page > 1) {

                current_quiz_page--;
            }
            await render_quiz(current_quiz_page);
        }
        async function nextpagequiz() {
            let Course_id = sessionStorage.getItem("lec_id");
            const course_quiz_query = query(collection(db, "courses", Course_id, "exams"));
            let courses_quiz_Data = await retrivequiers(course_quiz_query);
            if ((current_quiz_page * quiz_per_page) < courses_quiz_Data.length) {
                current_quiz_page++;
            }
            await render_quiz(current_quiz_page);
        }
        async function numberofpagequiz() {
            let Course_id = sessionStorage.getItem("lec_id");
            const course_quiz_query = query(collection(db, "courses", Course_id, "exams"));
            let courses_quiz_Data = await retrivequiers(course_quiz_query);
            return Math.ceil(courses_quiz_Data.length / quiz_per_page);
        }
        document.querySelector('#prev-btn_quiz').addEventListener('click', await previouspagequiz, false);
        document.querySelector('#next-btn_quiz').addEventListener('click', await nextpagequiz, false)

        //video input
        var fileInput = document.getElementById('browse');
        var listFile = document.getElementById('drop_zone');
        fileInput.onchange = function () {
            listFile.innerHTML = fileInput.files[0].name;
        }
        //pdf input
        var fileInputPdf = document.getElementById('browse_pdf');
        var listFilePdf = document.getElementById('drop_zone_pdf');
        fileInputPdf.onchange = function () {
            listFilePdf.innerHTML = fileInputPdf.files[0].name;
        }

        //set lecture data to fire store
        function validate_lec() {
            var check_lec_data = false
            const lec_name = document.getElementById("lec_name");
            const lec_desc = document.getElementById("lec_desc");
            const video_input = document.getElementById("browse").files.length;
            // validates 
            const lec_name_validation = document.getElementById("lec_name_validation");
            const lec_desc_validation = document.getElementById("lec_description_validation");
            const lec_video_validation = document.getElementById("video_validation");
            const lec_video_validation2 = document.getElementById("video_validation2");

            var size = document.getElementById("browse").files[0].size;
            size = size / 1024;
            size = Math.round(size);
            size = size / 1000000;
            if (size >= 1) {
                lec_video_validation2.style.display = "block";
                alert("(ex: videoPro Converter ) حجم الفديو كبير يمكنك استخدام احد برامج ضغط الفديوهات ")
                return false;

            }
            else {
                lec_video_validation2.style.display = "none";
                check_lec_data = true;
            }
            if (lec_name.value == "") {
                lec_name_validation.style.display = "block";
                return false;
            }
            else {
                lec_name_validation.style.display = "none";
                check_lec_data = true;
            }


            if (lec_desc.value == "") {
                lec_desc_validation.style.display = "block";
                return false;
            }
            else {
                lec_desc_validation.style.display = "none";
                check_lec_data = true;

            }
            if (video_input == 0) {
                lec_video_validation.style.display = "block";
                return false;

            }
            else {
                lec_video_validation.style.display = "none";
                check_lec_data = true;
            }

            return check_lec_data;
        }
        async function set_lec_data_to_firestore(url, duration2) {
            var chkBox1 = document.getElementById('checkScreenShot');
            var chkBox2 = document.getElementById('checkfree');
            var chkBox3 = document.getElementById('checkNotifi');
            var size = document.getElementById("browse").files[0].size;
            size = size / 1024;
            size = Math.round(size);
            CheckBox(chkBox1);
            CheckBox(chkBox2);
            CheckBox(chkBox3);
            let Course_id = sessionStorage.getItem("lec_id");
            const course_videos_query = query(collection(db, "videos"), where("courseId", "==", Course_id), orderBy("sortValue", "asc"));
            let courses_videos_Data = await retrivequiers(course_videos_query);



            const index = courses_videos_Data.length;
            const lec_name = document.getElementById("lec_name").value;
            const lec_desc = document.getElementById("lec_desc").value;
            const SH_Check = document.getElementById("checkScreenShot").value;
            const free_Check = document.getElementById("checkfree").value;
            const notfi_Check = document.getElementById("checkNotifi").value;

            const user_uid = await userUid();
            var SH_Check_bool = (SH_Check === "true");
            var free_Check_bool = (free_Check === "true");
            var notfi_Check_bool = (notfi_Check === "true");
            const docRef = await addDoc(collection(db, "videos"), {
                uId: user_uid,
                courseId: Course_id,
                sendNotification: notfi_Check_bool,
                trial: free_Check_bool,
                canRecord: SH_Check_bool,
                desc: lec_desc,
                title: lec_name,
                sortValue: index,
                duration: duration2,
                videoUrl: url,
                size: size,
            });
            const idref = doc(db, "videos", docRef.id);
            await updateDoc(idref, {
                id: docRef.id,
            });



        }

        var vid = document.createElement('video');
        document.querySelector('#browse').addEventListener('change', function () {
            // create url to use as the src of the video
            var fileURL = URL.createObjectURL(this.files[0]);
            vid.src = fileURL;
        });

        async function videoupload() {
            if (validate_lec() == true) {
                document.getElementById("addLecture").disabled = true;
                document.getElementById("close_lec").style.display = "none";
                document.getElementById("addLecture").style.cursor = "no-drop";
                var files = new Blob([document.getElementById("browse").files[0]], { "type": "video\/mp4" });
                var dropZone = document.getElementById('drop_zone');
                updateProgress(0)
                document.getElementById('progress-container').style.display = 'flex'
                var uploader = new VimeoUpload({
                    file: files,
                    token: "da89e74410b3a11cc3804778ac41aeb3",
                    name: document.getElementById("lec_name").value,
                    description: document.getElementById("lec_desc").value,

                    onError: async function (data) {
                        document.getElementById('addLecture').removeAttribute("disabled");
                        document.getElementById("myModal_lec").style.display = "none";
                        alert("يوجد مشكلة ف الوقت الحالي الرجاء اعادة المحاولة في وقت اخر")

                    },
                    onProgress: function (data) {

                        console.log(data.loaded, "/", data.total)
                        updateProgress(data.loaded / data.total)
                    },
                    onComplete: async function (videoId, index) {
                        var url = 'https://vimeo.com/' + videoId
                        console.log("video url : ", url);
                        if (index > -1) {
                            /* The metadata contains all of the uploaded video(s) details see: https://developer.vimeo.com/api/endpoints/videos#/{video_id} */
                            url = this.metadata[index].link //

                            /* add stringify the json object for displaying in a text area */
                            var pretty = JSON.stringify(this.metadata[index], null, 2)

                            ////console.log(pretty) /* echo server data */
                        }
                        var dur = vid.duration;
                        dur = Math.round(dur)
                        dur = dur.toString();
                        if (dur == null) {
                            dur = 0
                        }
                        await set_lec_data_to_firestore(url, dur);
                        alert("تم رفع المحاضره بنجاح");
                        document.getElementById("myModal_lec").style.display = "none";

                        //reset input values to null
                        document.getElementById("addLecture").disbaled = false;
                        document.getElementById("lec_name").value = ""
                        document.getElementById("lec_desc").value = ""
                        document.getElementById("checkScreenShot").value = false;
                        document.getElementById("checkfree").value = false;
                        document.getElementById("checkNotifi").value = true;
                        document.getElementById("checkScreenShot").checked == false;
                        document.getElementById("checkfree").checked == false;
                        document.getElementById("checkScreenShot").checked == false;
                        document.getElementById("progress-container").style.display = "none";
                        document.getElementById("progress").style.width = "0px";
                        document.getElementById("drop_zone").innerHTML = "Drop Files Here";
                        document.getElementById("addLecture").disabled = false;
                        document.getElementById("addLecture").style.cursor = "pointer";
                        document.getElementById("close_lec").style.display = "block";
                        document.getElementById("addLecture").disabled = false;
                    }
                })
                uploader.upload();


                /**
                 * Dragover handler to set the drop effect.
                 */

                /**
                * Updat progress bar.
                */
                function updateProgress(progress) {
                    progress = Math.ceil(progress * 100)
                    var element = document.getElementById('progress')
                    console.log(progress);
                    element.setAttribute('style', 'width:' + progress + '%')
                    element.innerHTML = '&nbsp;' + progress + '%';
                    console.log(element);
                }
                /**
                 * Wire up drag & drop listeners once page loads
                 */

                document.addEventListener('DOMContentLoaded', function () {
                    var dropZone = document.getElementById('drop_zone')
                    var browse = document.getElementById('browse')
                    dropZone.addEventListener('dragover', handleDragOver, false)
                    dropZone.addEventListener('drop', handleFileSelect, false)
                    browse.addEventListener('change', handleFileSelect, false)
                })
            }
            else {
                return;
            }
        }
        document.getElementById("addLecture").onclick = async () => {
            await videoupload();
            await renderLec(current_video_page);

        };


        // preview lecture in pop up
        $(document).on('click', '.VideoPopUp', async function () {
            let id = sessionStorage.getItem("vid_id");
            const videosnapshot = query(collection(db, "videos"), where("id", "==", id));
            let video_data = await retrivequiers(videosnapshot);
            let arr = video_data[0].videoUrl.split("/");
            var viemo_id = arr[3];
            document.getElementById("video_name").innerHTML = video_data[0].title;
            document.getElementById("video_desc").innerHTML = video_data[0].desc;
            document.getElementById("video_Div").innerHTML = '  <iframe id=\"videoframe\" src=\"https://player.vimeo.com/video/' + viemo_id + '\" width=\"700\" height=\"450\" frameborder=\"0\" title=\"' + video_data[0].title + '\" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>'

        });
        document.getElementById("exit_lec").onclick = () => {
            var myModal = document.getElementById('exampleModal')
            window.videoupload = function () { return false; };
            document.getElementById("myModal_lec").style.display = "none";
            myModal.setAttribute("data-bs-dismiss", "modal");
            document.getElementById("exit_lec").click();
            //myModal.style.display="none";
        };


        $(document).on('click', '.editlec', async function () {

            var modal_edit_lec = document.getElementById("myModal_lec_edit");
            modal_edit_lec.style.display = "block";
            var current_video_id = sessionStorage.getItem("video_id");
            ////console.log(current_video_id);
            await setdata_to_edit_lecture_form(current_video_id);

        })
        async function setdata_to_edit_lecture_form(id) {
            const docReff = doc(db, "videos", id);
            const docSnap = await getDoc(docReff);
            if (docSnap.exists()) {
                ////console.log(docSnap.data());
                document.getElementById("lec_name_edit").value = docSnap.data().title;
                document.getElementById("lec_desc_edit").value = docSnap.data().desc;
                var trial = docSnap.data().trial;
                var canRecord = docSnap.data().canRecord;
                var sendNotification = docSnap.data().sendNotification;
                if (canRecord == true) {
                    document.getElementById("checkScreenShot_edit").checked = true;
                    document.getElementById("checkScreenShot_edit").value = true;
                }
                else {
                    document.getElementById("checkScreenShot_edit").checked = false;
                    document.getElementById("checkScreenShot_edit").value = false;
                }
                if (trial == true) {
                    document.getElementById("checkfree_edit").checked = true;
                    document.getElementById("checkfree_edit").value = true;
                }
                else {
                    document.getElementById("checkfree_edit").checked = false;
                    document.getElementById("checkfree_edit").value = false;
                }
                if (sendNotification == true) {
                    document.getElementById("checkNotifi_edit").checked = true;
                    document.getElementById("checkNotifi_edit").value = true;
                }
                else {
                    document.getElementById("checkNotifi_edit").checked = false;
                    document.getElementById("checkNotifi_edit").value = false;
                }
            } else {
                // doc.data() will be undefined in this case
                ////console.log("No such document!");
            }
        }
        // valdiate edit lecture form
        function validtion_Edit_lec() {
            var check_lec_edit = false
            const lec_name_edit = document.getElementById("lec_name_edit");
            const lec_desc_edit = document.getElementById("lec_desc_edit");

            // validates 
            const lec_name_validation_edit = document.getElementById("lec_name_validation_edit");
            const lec_desc_validation_edit = document.getElementById("lec_description_validation_edit");

            if (lec_name_edit.value == "") {
                lec_name_validation_edit.style.display = "block";
                return false;
            }
            else {
                lec_name_validation_edit.style.display = "none";
                check_lec_edit = true;
            }


            if (lec_desc_edit.value == "") {
                lec_desc_validation_edit.style.display = "block";
                return false;
            }
            else {
                lec_desc_validation_edit.style.display = "none";
                check_lec_edit = true;

            }
            return check_lec_edit;
        }
        document.getElementById("editLecture").onclick = async () => {
            var current_video_id = sessionStorage.getItem("video_id");
            var chkBox1 = document.getElementById('checkScreenShot_edit');
            var chkBox2 = document.getElementById('checkfree_edit');

            CheckBox(chkBox1);
            CheckBox(chkBox2);

            if (validtion_Edit_lec() == true) {
                const video_ref = doc(db, "videos", current_video_id);
                const name = document.getElementById("lec_name_edit").value;
                const desc = document.getElementById("lec_desc_edit").value;
                const SH_Check = document.getElementById("checkScreenShot_edit").value;
                const free_Check = document.getElementById("checkfree_edit").value;

                var SH_Check_bool = (SH_Check === "true");
                var free_Check_bool = (free_Check === "true");

                await updateDoc(video_ref, {

                    trial: free_Check_bool,
                    canRecord: SH_Check_bool,
                    desc: desc,
                    title: name,
                });
                alert("تم تعديل المحاضره بنجاح");
                var modal_edit_lec = document.getElementById("myModal_lec_edit");
                modal_edit_lec.style.display = "none";
                await renderLec(current_video_page);
            }
            else {
                return;
            }
        };
        $(document).on('click', '.deletebtn', async function () {
            var lec_id = sessionStorage.getItem("video_id");
            var modal_Delete = document.getElementById('myModal_lec_delete');
            await deleteDoc(doc(db, "videos", lec_id));
            modal_Delete.style.display = "none";
            await renderLec(current_video_page);
            alert("تم مسح المحاضرة بنجاح ");
        });


        // add pdf 
        async function upload_pdf() {
            if (vlidatepdf() == true) {
                document.getElementById("addPdf").disabled = true;
                document.getElementById("close_pdf").style.display = "none";
                document.getElementById("addPdf").style.cursor = "no-drop";

                const fileSelector = document.getElementById('browse_pdf').files[0];
                let Course_id = sessionStorage.getItem("lec_id");
                updateProgressPdf(0)
                document.getElementById('progress-container_pdf').style.display = 'flex'

                const pdf_fb_id = doc(collection(db, "courses", Course_id, "pdfs"));
                ////console.log(pdf_fb_id.id);


                var storageRef = sRef(storage, "courses/" + Course_id + "/" + pdf_fb_id.id + ".pdf");

                const uploadTask = uploadBytesResumable(storageRef, fileSelector);

                // Register three observers:
                // 1. 'state_changed' observer, called any time the state changes
                // 2. Error observer, called on failure
                // 3. Completion observer, called on successful completion
                uploadTask.on('state_changed',
                    (snapshot) => {
                        // Observe state change events such as progress, pause, and resume
                        // Get task progress, including the number of bytes uploaded and the total number of bytes to be uploaded
                        ////console.log(snapshot.bytesTransferred);
                        ////console.log(snapshot.totalBytes);
                        updateProgressPdf(snapshot.bytesTransferred / snapshot.totalBytes)

                    },
                    (error) => {

                    },
                    async () => {
                        // Handle successful uploads on complete
                        // For instance, get the download URL: https://firebasestorage.googleapis.com/...
                        const download_url = await getDownloadURL(uploadTask.snapshot.ref);
                        var chkBox1 = document.getElementById('checkPdfDownloaf');
                        var chkBox2 = document.getElementById('CheckPdfPrev');
                        CheckBox(chkBox1);
                        CheckBox(chkBox2);


                        const pdf_name = document.getElementById("pdf_name").value;
                        const checkPdfDownloaf = document.getElementById('checkPdfDownloaf').value;
                        const CheckPdfPrev = document.getElementById('CheckPdfPrev').value;
                        const numPages = document.getElementById('pagesss').innerHTML;
                        const Course_id = sessionStorage.getItem("lec_id");


                        var datee = new Date();
                        var checkPdfDownloaf_bool = (checkPdfDownloaf === "true");
                        var CheckPdfPrev_bool = (CheckPdfPrev === "true");

                        const pdfref = await setDoc((db, pdf_fb_id), {
                            courseId: Course_id,
                            date: datee,
                            downloaded: checkPdfDownloaf_bool,
                            free: CheckPdfPrev_bool,
                            pageCount: parseInt(numPages),
                            title: pdf_name,
                            thumb: "",
                            id: pdf_fb_id.id,
                            pdfUrl: download_url,
                        });


                        alert("تم اضافة المستند بنجاح");
                        document.getElementById("pdf_name").value = "";
                        document.getElementById('checkPdfDownloaf').value = false;
                        document.getElementById('CheckPdfPrev').value = false;
                        document.getElementById('CheckPdfPrev').checked = false;
                        document.getElementById('checkPdfDownloaf').checked = false;
                        document.getElementById("myModal_pdf").style.display = "none";
                        document.getElementById('drop_zone_pdf').innerHTML = "Drop files here";
                        document.getElementById('pagesss').innerHTML = "";
                        document.getElementById("flexa7a").style.display = "none";
                        document.getElementById("addPdf").style.cursor = "pointer";
                        document.getElementById("close_pdf").style.display = "block";
                        document.getElementById("addPdf").disabled = false;
                        document.getElementById("progress-container_pdf").style.display = "none";
                        document.getElementById("progress_pdf").style.width = "0px";


                    }
                );
            }
            else {
                return;
            }
        }
        function updateProgressPdf(progress) {
            progress = Math.ceil(progress * 100);
            ////console.log(progress);
            var element = document.getElementById('progress_pdf')
            element.setAttribute('style', 'width:' + progress + '%')
            element.innerHTML = '&nbsp;' + progress + '%'
        }
        function vlidatepdf() {
            var check_pdf_data = false
            const pdf_name = document.getElementById("pdf_name");
            const pdf_input = document.getElementById("browse_pdf").files.length;

            // validates 
            const pdf_name_validation = document.getElementById("pdf_name_validation");
            const pdf_input_validtiopn = document.getElementById("pdf_validation")
            if (pdf_name.value == "") {
                pdf_name_validation.style.display = "block";
                return false;
            }
            else {
                pdf_name_validation.style.display = "none";
                check_pdf_data = true;
            }
            if (pdf_input == 0) {
                pdf_input_validtiopn.style.display = "block";
                return false;
            }
            else {
                pdf_input_validtiopn.style.display = "none";
                check_pdf_data = true;
            }


            return check_pdf_data;
        }

        let inputElement = document.getElementById('browse_pdf')
        inputElement.onchange = function (event) {

            var file = event.target.files[0];
            document.getElementById("flexa7a").style.display = "flex";
            //Step 2: Read the file using file reader
            var fileReader = new FileReader();

            fileReader.onload = function () {

                //Step 4:turn array buffer into typed array
                var typedarray = new Uint8Array(this.result);

                //Step 5:pdfjs should be able to read this
                const loadingTask = pdfjsLib.getDocument(typedarray);
                loadingTask.promise.then(pdf => {
                    document.getElementById('drop_zone_pdf').innerHTML = file.name;
                    document.getElementById('pagesss').innerHTML = pdf.numPages;
                    // The document is loaded here...
                });


            };
            //Step 3:Read the file as ArrayBuffer
            fileReader.readAsArrayBuffer(file);
        }
        document.getElementById("addPdf").onclick = async () => {

            await upload_pdf();
            await render_pdf(current_pdf_page);
        }

        //edit  pdf
        $(document).on('click', '.editpdf', async function () {

            var modal_edit_pdf = document.getElementById("myModal_pdf_edit");
            modal_edit_pdf.style.display = "block";
            var current_pdf_id = sessionStorage.getItem("pdf_id");
            await setdata_to_edit_pdf_form(current_pdf_id);
        })
        async function setdata_to_edit_pdf_form(id) {
            let Course_id = sessionStorage.getItem("lec_id");
            const docReff = doc(db, "courses", Course_id, 'pdfs', id);
            const docSnap = await getDoc(docReff);
            if (docSnap.exists()) {

                document.getElementById("pdf_name_edit").value = docSnap.data().title;
                var can_Download = docSnap.data().downloaded;
                var isFree = docSnap.data().free;
                ////console.log(isFree);
                ////console.log(can_Download);
                if (can_Download == true) {
                    document.getElementById("checkPdfDownloaf_edit").checked = true;
                    document.getElementById("checkPdfDownloaf_edit").value = true;
                }
                else {
                    document.getElementById("checkPdfDownloaf_edit").checked = false;
                    document.getElementById("checkPdfDownloaf_edit").value = false;
                }
                if (isFree == true) {
                    document.getElementById("CheckPdfPrev_edit").checked = true;
                    document.getElementById("CheckPdfPrev_edit").value = true;
                }
                else {
                    document.getElementById("CheckPdfPrev_edit").checked = false;
                    document.getElementById("CheckPdfPrev_edit").value = false;
                }
            } else {
                // doc.data() will be undefined in this case
                ////console.log("No such document!");
            }
        }
        // valdiate edit lecture form
        function validtion_Edit_pdf() {
            var check_pdf_edit = false
            const pdf_name_edit = document.getElementById("pdf_name_edit");

            // validates 
            const pdf_name_validation_edit = document.getElementById("pdf_name_validation_edit");


            if (pdf_name_edit.value == "") {
                pdf_name_validation_edit.style.display = "block";
                check_pdf_edit = false;
            }
            else {
                pdf_name_validation_edit.style.display = "none";
                check_pdf_edit = true;
            }

            return check_pdf_edit;
        }
        document.getElementById("editpdf").onclick = async () => {
            let Course_id = sessionStorage.getItem("lec_id");
            var current_pdf_id = sessionStorage.getItem("pdf_id");
            var chkBox1 = document.getElementById('checkPdfDownloaf_edit');
            var chkBox2 = document.getElementById('CheckPdfPrev_edit');

            CheckBox(chkBox1);
            CheckBox(chkBox2);
            ////console.log(validtion_Edit_pdf())
            if (validtion_Edit_pdf() == true) {
                const pdf_ref = doc(db, "courses", Course_id, 'pdfs', current_pdf_id);
                const name = document.getElementById("pdf_name_edit").value;

                const download_Check = document.getElementById("checkPdfDownloaf_edit").value;
                const free_Check = document.getElementById("CheckPdfPrev_edit").value;
                var free_Check_bool = (free_Check === "true");
                var download_Check_bool = (download_Check === "true");
                await updateDoc(pdf_ref, {
                    free: free_Check_bool,
                    downloaded: download_Check_bool,
                    title: name,
                });
                alert("تم تعديل المستند بنجاح");
                var modal_edit_pdf = document.getElementById("myModal_pdf_edit");
                modal_edit_pdf.style.display = "none";
                await render_pdf(current_pdf_page)
            }
            else {
                return;
            }
        };
        document.getElementById("exit_pdf").onclick = () => {
            var myModal = document.getElementById('exampleModalpdf')
            window.upload_pdf = function () { return false; };
            document.getElementById("myModal_pdf").style.display = "none";
            myModal.setAttribute("data-bs-dismiss", "modal");
            document.getElementById("exit_pdf").click();
            //myModal.style.display="none";
        };
        $(document).on('click', '.deletebtn_pdf', async function () {
            var pdf_id = sessionStorage.getItem("pdf_id");
            var Course_id = sessionStorage.getItem("lec_id");
            var modal_Delete = document.getElementById('myModal_pdf_delete');
            await deleteDoc(doc(db, "courses", Course_id, "pdfs", pdf_id));
            modal_Delete.style.display = "none";
            await render_pdf(current_pdf_page)
            alert("تم مسح المستند بنجاح ");
        });

        //quiz handle 

        // check box for time
        const checkbox = document.getElementById('time')

        $(document).on('change', '#time', function (event) {
            if (event.currentTarget.checked) {
                document.getElementById('quiz_time_div').style.display = "block"
            } else {
                document.getElementById('quiz_time_div').style.display = "none"
            }
        })
        $(document).on('change', '#time_edit', function (event) {
            if (event.currentTarget.checked) {
                document.getElementById('quiz_time_div_edit').style.display = "block"
            } else {
                document.getElementById('quiz_time_div_edit').style.display = "none"
            }
        })


        //exit comfrmition 
        document.getElementById("exit_quiz").onclick = () => {
            // set varibals of quiz to defualt 
            current_choise_index = 1;
            question_number = 1;
            quiz_data = { courseid: "", name: "", repeatbool: false, timerbool: false, time: 0, freebool: false, date: new Date(), examtake: 0, quizcount: 0 };
            question_arr = [];

            var form = document.getElementById("quiz_elements")
            var main_quiz_form = "<div class=\"form-group\" style=\"text-align:center ;\">"
            main_quiz_form += "<label for=\"inputEmail4\">quiz title</label>"
            main_quiz_form += "<input type=\"text\" class=\"form-control\" id=\"quiz_name\" placeholder=\"عنوان الامتحان\">"
            main_quiz_form += "<p class=\"validation\" id=\"quiz_name_validation\">Quiz title must be filled out </p>"
            main_quiz_form += "</div>"
            main_quiz_form += "<div class=\"form-group\">"
            main_quiz_form += "<div class=\"form-check\">"
            main_quiz_form += "<input class=\"form-check-input\" type=\"checkbox\" value=\"false\" id=\"enroll\">"
            main_quiz_form += "<label class=\"form-check-label\" for=\"flexCheckDefault\">"
            main_quiz_form += "هل الامتحان يتطلب التسجيل بالكورس ؟  </label>"
            main_quiz_form += "</div>"
            main_quiz_form += "<div class=\"form-check\">"
            main_quiz_form += "<input class=\"form-check-input\" type=\"checkbox\" value=\"false\" id=\"repeat\">"
            main_quiz_form += "<label class=\"form-check-label\" for=\"flexCheckDefault\">"
            main_quiz_form += "   هل يمكن اعادة الامتحان ؟ </label>"
            main_quiz_form += "</div>"
            main_quiz_form += "<div class=\"form-check\">"
            main_quiz_form += "<input class=\"form-check-input\" type=\"checkbox\" value=\"true\" id=\"time\">"
            main_quiz_form += "<label class=\"form-check-label\" for=\"flexCheckDefault\">"
            main_quiz_form += "هل الامتحان وقت معين ؟</label>"
            main_quiz_form += "</div>"
            main_quiz_form += "</div>"
            main_quiz_form += "<div class=\"form-group\" id=\"quiz_time_div\" style=\"text-align:center ;\">"
            main_quiz_form += "<label for=\"inputEmail4\">Quiz time</label>"
            main_quiz_form += "<input type=\"text\" class=\"form-control\" id=\"quiz_time\" placeholder=\"الوقت بالدقايق\">"
            main_quiz_form += "<p class=\"validation\" id=\"quiz_time_validation\">Quiz Time must be filled out</p>"
            main_quiz_form += "</div>"
            main_quiz_form += "<div class=\"form-group\" id=\"grid\">"
            main_quiz_form += "<button type=\"button\"  id=\"Next_quiz\" class=\"btn btn-primary\">Next</button>"
            main_quiz_form += "</div>"
            form.innerHTML = main_quiz_form;

            var myModal = document.getElementById('exampleModalquiz')
            window.upload_pdf = function () { return false; };
            document.getElementById("myModal_quizzz").style.display = "none";
            myModal.setAttribute("data-bs-dismiss", "modal");
            document.getElementById("exit_quiz").click();
            //myModal.style.display="none";
        };

        // when click add choice it apend a check box
        $(document).on('click', '#add_choices', function () {
            add_checkbox();
        })
        function add_checkbox() {
            var fieldset = document.getElementById("choices");
            for (let i = 1; i < current_choise_index; i++) {

                if (document.getElementById("quiz_" + question_number + "_choise_" + i).value == "") {
                    document.getElementById("valid_choice").style.display = "block";
                    return;
                }
            }


            document.getElementById("valid_choice").style.display = "none";
            const div = document.createElement("div");
            div.setAttribute("class", "form-check flex");

            const input_text = document.createElement("input");
            input_text.setAttribute("type", "text");
            input_text.setAttribute("class", "form-control");
            input_text.setAttribute("placeholder", "اختيار");
            input_text.setAttribute("id", "quiz_" + question_number + "_choise_" + current_choise_index);
            div.appendChild(input_text);

            const input_check = document.createElement("input");
            input_check.setAttribute("type", "radio");
            input_check.setAttribute("class", "form-check-input");
            input_check.setAttribute("name", "gridRadios");
            input_check.setAttribute("value", current_choise_index);
            input_check.setAttribute("id", "quiz_" + question_number + "_check_" + current_choise_index);
            div.appendChild(input_check);
            fieldset.appendChild(div);

            current_choise_index++;
        }


        // when click next in add quiz render question
        $(document).on('click', '#Next_quiz', function () {
            renderQuestion_first_time();
        })
        function renderQuestion_first_time() {
            var quiz_name_value = document.getElementById("quiz_name").value;

            var time_Check = document.getElementById("time");
            CheckBox(time_Check);
            var time_check_bool = (time_Check.value === "true");

            var enroll_Check = document.getElementById("enroll");
            CheckBox(enroll_Check);
            var enroll_Check_bool = (enroll_Check.value === "true");

            var repeat_Check = document.getElementById("repeat");
            CheckBox(repeat_Check);
            var repeat_Check_bool = (repeat_Check.value === "true");


            if (quiz_name_value != "" && validate_quiz_time() == true) {
                quiz_data.courseid = sessionStorage.getItem("lec_id");
                quiz_data.name = quiz_name_value;
                quiz_data.timerbool = time_check_bool;
                quiz_data.freebool = enroll_Check_bool;
                quiz_data.repeatbool = repeat_Check_bool;

                var form = document.getElementById("quiz_elements");
                var quiz = "<div class=\"form-group\" style=\"text-align:center ;\">"
                quiz += "<label for=\"inputEmail4\"><span id=\"quiz_counter\">" + question_number + "</span>: سؤال رقم </label>"
                quiz += "<input type=\"text\" class=\"form-control\" id=\"question_" + question_number + "\" placeholder=\"سؤال\">"
                quiz += "</div>"
                quiz += "<h4 class=\"right\">choices</h4>"
                quiz += "<fieldset id=\"choices\" class=\"form-group\">"
                quiz += "<div class=\"form-check flex\">"
                quiz += "<input type=\"text\" class=\"form-control\" id=\"quiz_" + question_number + "_choise_" + current_choise_index + "\" placeholder=\"اختيار\">"
                quiz += "<input class=\"form-check-input\" type=\"radio\" name=\"gridRadios\" id=\"quiz_" + question_number + "_check_" + current_choise_index + "\" value=\"" + current_choise_index + "\">"
                quiz += "</div>"
                current_choise_index++;
                quiz += "<div class=\"form-check flex\">"
                quiz += "<input type=\"text\" class=\"form-control\" id=\"quiz_" + question_number + "_choise_" + current_choise_index + "\" placeholder=\"اختيار\">"
                quiz += "<input class=\"form-check-input\" type=\"radio\" name=\"gridRadios\" id=\"quiz_" + question_number + "_check_" + current_choise_index + "\" value=\"" + current_choise_index + "\">"
                quiz += "</div>"
                current_choise_index++;
                quiz += "</fieldset>"
                quiz += "<p class=\"validation\" id=\"valid_choice\">املءالاختيارات لاضافة اختيار جديد</p>"
                quiz += "<a href=\"#\" id=\"add_choices\" class=\"ahref\">اضافة اختيار <span class=\"material-symbols-sharp\">add</span></a>"
                quiz += "<p class=\"validation\" id=\"quiz_validation\">All fields must be filled out</p>"
                quiz += "<div class=\"centertwo\">"
                quiz += "<button type=\"button\"  id=\"quiz_done\" class=\"btn btn-primary\">Finish quiz</button>"
                quiz += "<button id=\"add_more\" type=\"button\"  class=\"btn btn-primary\">add question</button>"
                quiz += "</div>"
                form.innerHTML = quiz;
                ////console.log(quiz_data);

            }
            else {

                if (quiz_name_value != "") {
                    document.getElementById("quiz_name_validation").style.display = "none";
                } else {
                    document.getElementById("quiz_name_validation").style.display = "block";
                }

            }

        }
        //validete quiz time input if user check the time checkbox
        function validate_quiz_time() {

            const checkbox = document.getElementById('time');
            const quiz_time_value = document.getElementById("quiz_time").value;
            if (checkbox.checked) {

                if (quiz_time_value != "") {

                    var valueInt = parseInt(quiz_time_value)
                    ////console.log(valueInt);
                    if (valueInt < 5 || valueInt > 100) {

                        document.getElementById("quiz_time_validation").innerHTML = " وقت للامتحان يتراوج من 5 دقائق الي 100 دقيقة";
                        document.getElementById("quiz_time_validation").style.display = "block";
                        return false;
                    }
                    else {
                        quiz_data.time = valueInt;
                        return true;
                    }
                } else {

                    document.getElementById("quiz_time_validation").innerHTML = "Quiz Time must be filled out";
                    document.getElementById("quiz_time_validation").style.display = "block"
                    return false;
                }
            }
            else {

                return true;
            }
        }

        // when click add question add more quetions
        $(document).on('click', '#add_more', function () {
            document.getElementById("valid_choice").style.display = "none";
            if (question_validation() == true) {
                if (radio_buttons_validation() == true) {
                    document.getElementById("quiz_validation").style.display = "none";
                    get_quiz_data();
                    add_question();
                }
                else {
                    document.getElementById("quiz_validation").innerHTML = "one check box at least must be cheacked";
                    document.getElementById("quiz_validation").style.display = "block";
                }
            }
            else {
                document.getElementById("quiz_validation").innerHTML = "All fields must be filled out";
                document.getElementById("quiz_validation").style.display = "block";
            }

        })
        function add_question() {
            question_number++;
            current_choise_index = 1;
            renderQuestion();
        }
        function renderQuestion() {

            var form = document.getElementById("quiz_elements");
            var quiz = "<div class=\"form-group\" style=\"text-align:center ;\">"
            quiz += "<label for=\"inputEmail4\"><span id=\"quiz_counter\">" + question_number + "</span>: سؤال رقم </label>"
            quiz += "<input type=\"text\" class=\"form-control\" id=\"question_" + question_number + "\" placeholder=\"سؤال\">"
            quiz += "</div>"
            quiz += "<h4 class=\"right\">choices</h4>"
            quiz += "<fieldset id=\"choices\" class=\"form-group\">"
            quiz += "<div class=\"form-check flex\">"
            quiz += "<input type=\"text\" class=\"form-control\" id=\"quiz_" + question_number + "_choise_" + current_choise_index + "\" placeholder=\"اختيار\">"
            quiz += "<input class=\"form-check-input\" type=\"radio\" name=\"gridRadios\" id=\"quiz_" + question_number + "_check_" + current_choise_index + "\" value=\"" + current_choise_index + "\">"
            quiz += "</div>"
            current_choise_index++;
            quiz += "<div class=\"form-check flex\">"
            quiz += "<input type=\"text\" class=\"form-control\" id=\"quiz_" + question_number + "_choise_" + current_choise_index + "\" placeholder=\"اختيار\">"
            quiz += "<input class=\"form-check-input\" type=\"radio\" name=\"gridRadios\" id=\"quiz_" + question_number + "_check_" + current_choise_index + "\" value=\"" + current_choise_index + "\">"
            quiz += "</div>"
            current_choise_index++;
            quiz += "</fieldset>"
            quiz += "<p class=\"validation\" id=\"valid_choice\">املءالاختيارات لاضافة اختيار جديد</p>"
            quiz += "<a href=\"#\" id=\"add_choices\" class=\"ahref\">اضافة اختيار <span class=\"material-symbols-sharp\">add</span></a>"
            quiz += "<p class=\"validation\" id=\"quiz_validation\">All fields must be filled out</p>"
            quiz += "<div class=\"centertwo\">"
            quiz += "<button  type=\"button\" id=\"quiz_done\" class=\"btn btn-primary\">Finish quiz</button>"
            quiz += "<button id=\"add_more\" type=\"button\"  class=\"btn btn-primary\">add question</button>"
            quiz += "</div>"
            form.innerHTML = quiz;
        }


        function question_validation() {

            var question_value = document.getElementById("question_" + question_number).value;
            var answers = new Array();
            var index = 1;


            for (let i = 0; i < current_choise_index - 1; i++) {

                var choice = document.getElementById("quiz_" + question_number + "_choise_" + index).value;
                answers.push(choice);
                index++;
            }


            for (var i = 0; i < answers.length; i++) {
                if (answers[i] === "") {
                    document.getElementById("quiz_validation").style.display = "block";
                    return false;
                }
            }
            if (question_value == "") {
                document.getElementById("quiz_validation").style.display = "block";
                return false;
            }
            document.getElementById("quiz_validation").style.display = "none";
            return true;

        }
        function radio_buttons_validation() {
            const radioButtons = document.querySelectorAll('input[name="gridRadios"]');
            for (const radioButton of radioButtons) {
                if (radioButton.checked) {
                    return true;
                }
            }

        }

        function get_quiz_data() {
            var obj = {};
            ////console.log(question_arr)
            const radioButtons = document.querySelectorAll('input[name="gridRadios"]');
            var question_value = document.getElementById("question_" + question_number).value;
            var index = 1;
            var correct_answer_index;
            var choicess = [];
            obj.question = question_value;

            for (let i = 0; i < current_choise_index - 1; i++) {
                var choice = document.getElementById("quiz_" + question_number + "_choise_" + index).value;
                if (choice != "") {
                    choicess.push(choice);
                }


                index++;
            }

            for (const radioButton of radioButtons) {
                if (radioButton.checked) {
                    correct_answer_index = radioButton.value;
                }
            }
            obj.correct = document.getElementById("quiz_" + question_number + "_choise_" + correct_answer_index).value;
            obj.choices = choicess;


            question_arr.push(obj);
        }



        // add quiz to fire store
        $(document).on('click', '#quiz_done', async function () {
            if (question_arr.length >= 1) {
                var question_id;
                document.getElementById("quiz_validation").style.display = "none";

                // quiz set to fire store 
                var Course_id = quiz_data.courseid;

                const quiz_id = doc(collection(db, "courses", Course_id, "exams"));

                const quizref = await setDoc((db, quiz_id), {
                    id: quiz_id.id,
                    courseId: Course_id,
                    name: quiz_data.name,
                    withTimer: quiz_data.timerbool,
                    timeInMinutes: quiz_data.time,
                    free: quiz_data.freebool,
                    date: new Date(),
                    canRepeat: quiz_data.repeatbool,
                });
                ////console.log(question_arr);
                // loop throush each quition to add his data
                for (let i = 0; i < question_number - 1; i++) {
                    ////console.log(i);
                    ////console.log(question_arr);
                    question_id = doc(collection(db, "courses", Course_id, "exams", quiz_id.id, "questions"));
                    const cref = await setDoc((db, question_id), {
                        id: question_id.id,
                        question: question_arr[i].question,
                        options: question_arr[i].choices,
                        correctAnswer: question_arr[i].correct,
                        sortValue: i,
                    });

                }

                // set varibals of quiz to defualt 
                current_choise_index = 1;
                question_number = 1;
                quiz_data = { courseid: "", name: "", repeatbool: false, timerbool: false, time: 0, freebool: false, date: new Date(), examtake: 0, quizcount: 0 };
                question_arr = [];

                var form = document.getElementById("quiz_elements")
                var main_quiz_form = "<div class=\"form-group\" style=\"text-align:center ;\">"
                main_quiz_form += "<label for=\"inputEmail4\">quiz title</label>"
                main_quiz_form += "<input type=\"text\" class=\"form-control\" id=\"quiz_name\" placeholder=\"عنوان الامتحان\">"
                main_quiz_form += "<p class=\"validation\" id=\"quiz_name_validation\">Quiz title must be filled out </p>"
                main_quiz_form += "</div>"
                main_quiz_form += "<div class=\"form-group\">"
                main_quiz_form += "<div class=\"form-check\">"
                main_quiz_form += "<input class=\"form-check-input\" type=\"checkbox\" value=\"false\" id=\"enroll\">"
                main_quiz_form += "<label class=\"form-check-label\" for=\"flexCheckDefault\">"
                main_quiz_form += "هل الامتحان يتطلب التسجيل بالكورس ؟  </label>"
                main_quiz_form += "</div>"
                main_quiz_form += "<div class=\"form-check\">"
                main_quiz_form += "<input class=\"form-check-input\" type=\"checkbox\" value=\"false\" id=\"repeat\">"
                main_quiz_form += "<label class=\"form-check-label\" for=\"flexCheckDefault\">"
                main_quiz_form += "   هل يمكن اعادة الامتحان ؟ </label>"
                main_quiz_form += "</div>"
                main_quiz_form += "<div class=\"form-check\">"
                main_quiz_form += "<input class=\"form-check-input\" type=\"checkbox\" value=\"true\" id=\"time\">"
                main_quiz_form += "<label class=\"form-check-label\" for=\"flexCheckDefault\">"
                main_quiz_form += "هل الامتحان وقت معين ؟</label>"
                main_quiz_form += "</div>"
                main_quiz_form += "</div>"
                main_quiz_form += "<div class=\"form-group\" id=\"quiz_time_div\" style=\"text-align:center ;\">"
                main_quiz_form += "<label for=\"inputEmail4\">Quiz time</label>"
                main_quiz_form += "<input type=\"text\" class=\"form-control\" id=\"quiz_time\" placeholder=\"الوقت بالدقايق\">"
                main_quiz_form += "<p class=\"validation\" id=\"quiz_time_validation\">Quiz Time must be filled out</p>"
                main_quiz_form += "</div>"
                main_quiz_form += "<div class=\"form-group\" id=\"grid\">"
                main_quiz_form += "<button type=\"button\"  id=\"Next_quiz\" class=\"btn btn-primary\">Next</button>"
                main_quiz_form += "</div>"
                form.innerHTML = main_quiz_form;

                var myModal = document.getElementById('exampleModalquiz')
                window.upload_pdf = function () { return false; };
                document.getElementById("myModal_quizzz").style.display = "none";
                await render_quiz(current_quiz_page);
                alert("تم اضافة الامتحان");
            }
            else {
                if (question_validation() == true) {
                    if (radio_buttons_validation() == true) {
                        var question_id;
                        document.getElementById("quiz_validation").style.display = "none";
                        get_quiz_data();
                        // quiz set to fire store 
                        var Course_id = quiz_data.courseid;

                        const quiz_id = doc(collection(db, "courses", Course_id, "exams"));

                        const quizref = await setDoc((db, quiz_id), {
                            id: quiz_id.id,
                            courseId: Course_id,
                            name: quiz_data.name,
                            withTimer: quiz_data.timerbool,
                            timeInMinutes: quiz_data.time,
                            free: quiz_data.freebool,
                            date: new Date(),
                            canRepeat: quiz_data.repeatbool,
                        });

                        // loop throush each quition to add his data
                        for (let i = 0; i < question_number; i++) {
                            ////console.log(i);
                            ////console.log(question_arr);
                            question_id = doc(collection(db, "courses", Course_id, "exams", quiz_id.id, "questions"));
                            const cref = await setDoc((db, question_id), {
                                id: question_id.id,
                                question: question_arr[i].question,
                                options: question_arr[i].choices,
                                correctAnswer: question_arr[i].correct,
                                sortValue: i,
                            });

                        }

                        // set varibals of quiz to defualt 
                        current_choise_index = 1;
                        question_number = 1;
                        quiz_data = { courseid: "", name: "", repeatbool: false, timerbool: false, time: 0, freebool: false, date: new Date(), examtake: 0, quizcount: 0 };
                        question_arr = [];

                        var form = document.getElementById("quiz_elements")
                        var main_quiz_form = "<div class=\"form-group\" style=\"text-align:center ;\">"
                        main_quiz_form += "<label for=\"inputEmail4\">quiz title</label>"
                        main_quiz_form += "<input type=\"text\" class=\"form-control\" id=\"quiz_name\" placeholder=\"عنوان الامتحان\">"
                        main_quiz_form += "<p class=\"validation\" id=\"quiz_name_validation\">Quiz title must be filled out </p>"
                        main_quiz_form += "</div>"
                        main_quiz_form += "<div class=\"form-group\">"
                        main_quiz_form += "<div class=\"form-check\">"
                        main_quiz_form += "<input class=\"form-check-input\" type=\"checkbox\" value=\"false\" id=\"enroll\">"
                        main_quiz_form += "<label class=\"form-check-label\" for=\"flexCheckDefault\">"
                        main_quiz_form += "هل الامتحان يتطلب التسجيل بالكورس ؟  </label>"
                        main_quiz_form += "</div>"
                        main_quiz_form += "<div class=\"form-check\">"
                        main_quiz_form += "<input class=\"form-check-input\" type=\"checkbox\" value=\"false\" id=\"repeat\">"
                        main_quiz_form += "<label class=\"form-check-label\" for=\"flexCheckDefault\">"
                        main_quiz_form += "   هل يمكن اعادة الامتحان ؟ </label>"
                        main_quiz_form += "</div>"
                        main_quiz_form += "<div class=\"form-check\">"
                        main_quiz_form += "<input class=\"form-check-input\" type=\"checkbox\" value=\"true\" id=\"time\">"
                        main_quiz_form += "<label class=\"form-check-label\" for=\"flexCheckDefault\">"
                        main_quiz_form += "هل الامتحان وقت معين ؟</label>"
                        main_quiz_form += "</div>"
                        main_quiz_form += "</div>"
                        main_quiz_form += "<div class=\"form-group\" id=\"quiz_time_div\" style=\"text-align:center ;\">"
                        main_quiz_form += "<label for=\"inputEmail4\">Quiz time</label>"
                        main_quiz_form += "<input type=\"text\" class=\"form-control\" id=\"quiz_time\" placeholder=\"الوقت بالدقايق\">"
                        main_quiz_form += "<p class=\"validation\" id=\"quiz_time_validation\">Quiz Time must be filled out</p>"
                        main_quiz_form += "</div>"
                        main_quiz_form += "<div class=\"form-group\" id=\"grid\">"
                        main_quiz_form += "<button type=\"button\"  id=\"Next_quiz\" class=\"btn btn-primary\">Next</button>"
                        main_quiz_form += "</div>"
                        form.innerHTML = main_quiz_form;

                        var myModal = document.getElementById('exampleModalquiz')
                        window.upload_pdf = function () { return false; };
                        document.getElementById("myModal_quizzz").style.display = "none";
                        await render_quiz(current_quiz_page);
                        alert("تم اضافة الامتحان");

                    }
                    else {
                        document.getElementById("quiz_validation").innerHTML = "one check box at least must be cheacked";
                        document.getElementById("quiz_validation").style.display = "block";
                    }
                }
                else {
                    document.getElementById("quiz_validation").innerHTML = "All fields must be filled out";
                    document.getElementById("quiz_validation").style.display = "block";
                }
            }
        })



        //preview quiz handle
        const option_list = document.querySelector(".option_list");
        let timeValue = 15;
        let que_count = 0;
        let que_numb = 1;
        let userScore = 0;
        let counter;
        const result_box = document.querySelector(".result_box");
        const next_btn = document.getElementById("next_btn_quiz");
        const bottom_ques_counter = document.querySelector("footer .total_que");
        const timeCount = document.getElementById("time_left");
        const exit_quiz = document.getElementById("quit_quiz");
        exit_quiz.onclick = () => {
            const info_box = document.querySelector(".preview_quiz_info");
            info_box.style.display = "none";
            quiz_preview_data = { time: "", count: "", name: "", repeat: false, free: false, timer: false }
            question_arr_prev = [];
        }
        const exit_quiz2 = document.getElementById("quiz_end");
        exit_quiz2.onclick = () => {
            const info_box = document.querySelector(".preview_quiz_res");
            info_box.style.display = "none";
        }
        const start_quiz = document.getElementById("start_quiz")
        start_quiz.onclick = () => {
            const info_box = document.querySelector(".preview_quiz_info");
            info_box.style.display = "none";
            const quiz_box = document.querySelector(".preview_quiz_box");
            quiz_box.style.display = "block";
            showQuetions(0); //calling showQestions function
            queCounter(1); //passing 1 parameter to queCounter
            startTimer(quiz_preview_data.time); //calling startTimer function

        }
        const end_quiz = document.getElementById("quit_score")
        end_quiz.onclick = () => {
            showResult();
        }
        next_btn.onclick = () => {
            if (que_count < question_arr_prev.length - 1) { //if question count is less than total question length
                que_count++; //increment the que_count value
                que_numb++; //increment the que_numb value
                showQuetions(que_count); //calling showQestions function
                queCounter(que_numb); //passing que_numb value to queCounter
                next_btn.style.display = "none";
            } else {
                clearInterval(counter); //clear counter
                showResult(); //calling showResult function
            }
        }
        $(document).on('click', '.quizpopup', async function () {
            let Course_id = sessionStorage.getItem("lec_id");
            let quiz_id = sessionStorage.getItem("quiz_id");
            const quiz_query = query(collection(db, "courses", Course_id, "exams"), where("id", "==", quiz_id));
            let quiz_data = await retrivequiers(quiz_query);
            await getquizdata();
            document.getElementById("quiz_prev_title").innerHTML = quiz_preview_data.name;
            if (quiz_data[0].timeInMinutes == "0") {
                ////console.log("a7aasdsa")
                document.getElementById("quiz_info_time").innerHTML = "1. This quiz with no time limt"
                document.getElementById("quiz_prev_timer").style.display = "none";

            }
            else {
                ////console.log("a7aasssssssssssssssssssssdsa")
                document.getElementById("quiz_prev_timer").style.display = "flex";
                document.getElementById("quiz_info_time").innerHTML = "1. You will have only <span>" + quiz_data[0].timeInMinutes + "</span> minutes to finish"
            }
        });
        async function getquizdata() {
            let quiz_id = sessionStorage.getItem("quiz_id");
            let Course_id = sessionStorage.getItem("lec_id");
            const quiz_query = query(collection(db, "courses", Course_id, "exams"), where("id", "==", quiz_id));
            let quiz_data = await retrivequiers(quiz_query);
            quiz_preview_data.time = quiz_data[0].timeInMinutes;
            quiz_preview_data.count = quiz_data[0].questionCount;
            quiz_preview_data.name = quiz_data[0].name;
            quiz_preview_data.free = quiz_data[0].free;
            quiz_preview_data.repeat = quiz_data[0].canRepeat;
            quiz_preview_data.timer = quiz_data[0].withTimer;
            const questions_query = query(collection(db, "courses", Course_id, "exams", quiz_id, "questions"), orderBy("sortValue", "asc"));
            let questions_data = await retrivequiers(questions_query);
            questions_data.forEach((ques) => {
                var obj = {};
                obj.correct = ques.correctAnswer;
                obj.question = ques.question;
                obj.index = ques.sortValue + 1;
                obj.options = ques.options;
                obj.id = ques.id;
                question_arr_prev.push(obj);
            });
            ////console.log(question_arr_prev);

        }
        function showQuetions(index) {

            const que_text = document.querySelector(".que_text");
            var option_tag = ""
            //creating a new span and div tag for question and option and passing the value using array index
            let que_tag = '<span>' + parseInt(index + 1) + ". " + question_arr_prev[index].question + '</span>';
            question_arr_prev[index].options.forEach((option) => {
                option_tag += '<div class="option"><span>' + option + '</span></div>';
            })

            que_text.innerHTML = que_tag; //adding new span tag inside que_tag
            option_list.innerHTML = option_tag; //adding new div tag inside option_tag

            const option = option_list.querySelectorAll(".option");
            // set onclick attribute to all available options

        }
        let tickIconTag = '<div class="icon tick"><i class="fas fa-check"></i></div>';
        let crossIconTag = '<div class="icon cross"><i class="fas fa-times"></i></div>';
        //if user clicked on option
        $(document).on('click', '.option', function () {


            let userAns = this.textContent; //getting user selected option
            let correcAns = question_arr_prev[que_count].correct; //getting correct answer from array
            ////console.log(correcAns);
            const allOptions = option_list.children.length; //getting all option items

            if (userAns == correcAns) { //if user selected option is equal to array's correct answer
                userScore += 1; //upgrading score value with 1
                this.classList.add("correct"); //adding green color to correct selected option
                this.insertAdjacentHTML("beforeend", tickIconTag); //adding tick icon to correct selected option
                ////console.log("Correct Answer");
                ////console.log("Your correct answers = " + userScore);
            } else {
                this.classList.add("incorrect"); //adding red color to correct selected option
                this.insertAdjacentHTML("beforeend", crossIconTag); //adding cross icon to correct selected option
                ////console.log("Wrong Answer");
                for (let i = 0; i < allOptions; i++) {
                    if (option_list.children[i].textContent == correcAns) { //if there is an option which is matched to an array answer 
                        option_list.children[i].setAttribute("class", "option correct"); //adding green color to matched option
                        option_list.children[i].insertAdjacentHTML("beforeend", tickIconTag); //adding tick icon to matched option
                        ////console.log("Auto selected correct answer.");
                    }
                }
            }
            for (let i = 0; i < allOptions; i++) {
                option_list.children[i].classList.add("disabled"); //once user select an option then disabled all options
            }
            next_btn.style.display = "block"; //show the next button if user selected any option

        })
        function showResult() {
            clearInterval(counter); //clear counter
            const quiz_box = document.querySelector(".preview_quiz_box");
            quiz_box.style.display = "none";
            const res_box = document.querySelector(".preview_quiz_res");
            res_box.style.display = "block";
            const scoreText = result_box.querySelector(".score_text");
            document.getElementById("your_Score").innerHTML = userScore;
            document.getElementById("total_score").innerHTML = question_arr_prev.length;
            timeValue = 15;
            que_count = 0;
            que_numb = 1;
            userScore = 0;
            counter;
            quiz_preview_data = { time: "", count: "", name: "", repeat: false, free: false, timer: false }
            question_arr_prev = [];

        }
        function startTimer(time) {
            timeCount.innerHTML = time;
            counter = setInterval(timer, 60 * 1000);
            function timer() {
                timeCount.innerHTML = time; //changing the value of timeCount with time value
                time--; //decrement the time value

                if (time < 0) { //if timer is less than 0
                    clearInterval(counter); //clear counter

                    const allOptions = option_list.children.length; //getting all option items
                    let correcAns = question_arr_prev[que_count].answer; //getting correct answer from array
                    for (let i = 0; i < allOptions; i++) {
                        if (option_list.children[i].textContent == correcAns) { //if there is an option which is matched to an array answer
                            option_list.children[i].setAttribute("class", "option correct"); //adding green color to matched option
                            option_list.children[i].insertAdjacentHTML("beforeend", tickIconTag); //adding tick icon to matched option
                            ////console.log("Time Off: Auto selected correct answer.");
                        }
                    }
                    for (let i = 0; i < allOptions; i++) {
                        option_list.children[i].classList.add("disabled"); //once user select an option then disabled all options
                    }
                    showResult()
                }
            }
        }
        function queCounter(index) {
            //creating a new span tag and passing the question number and total question
            let totalQueCounTag = '<span><p>' + index + '</p> of <p>' + question_arr_prev.length + '</p> Questions</span>';
            bottom_ques_counter.innerHTML = totalQueCounTag;  //adding new span tag inside bottom_ques_counter
        }

        //Edit quiz yalhway

        var modal_quiz_edit = document.getElementById("myModal_quiz_edit");
        var modal_quiz_add = document.getElementById("myModal_quizzz");
        var modal_Delete_pdf = document.getElementById('myModal_pdf_delete');
        var modal_Delete_course = document.getElementById('myModal_pdf_course');
        var modal_pdf_edit = document.getElementById("myModal_pdf_edit");
        var modal_Delete = document.getElementById('myModal_lec_delete');
        var myModal_video = document.getElementById("myModal_video");
        var modal_edit_lec = document.getElementById("myModal_lec_edit");
        var myModal_lec = document.getElementById("myModal_lec");
        var modal_edit_quiz = document.getElementById("myModal_course_edit");
        var modal = document.getElementById("myModal");
        // Get the button that opens the modal
        // Get the <span> element that closes the modal
        var span_quiz_edit = document.getElementsByClassName("close_quiz_edit")[0];
        // When the user clicks on the button, open the modal
        // When the user clicks on <span> (x), close the modal
        span_quiz_edit.onclick = function () {
            modal_quiz_edit.style.display = "none";
            quiz_preview_data = { time: "", count: "", name: "", repeat: false, free: false, timer: false }
            question_arr_prev = [];
        }
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function (event) {
            if (event.target == modal_quiz_edit) {
                modal_quiz_edit.style.display = "none";
                quiz_preview_data = { time: "", count: "", name: "", repeat: false, free: false, timer: false }
                question_arr_prev = [];
            }
            if (event.target == modal) {
                modal.style.display = "none";
            }
            if (event.target == modal_Delete_course) {
                modal_Delete_course.style.display = "none";
            }
            if (event.target == modal_edit_quiz) {
                ////console.log("bye");
                modal_edit_quiz.style.display = "none";
            }
            if (event.target == modal_edit_lec) {
                modal_edit_lec.style.display = "none";
            }
            if (event.target == myModal_video) {
                $("iframe").each(function () {
                    var src = $(this).attr('src');
                    $(this).attr('src', src);
                });
                myModal_video.style.display = "none";
            }
            if (event.target == modal_Delete) {
                modal_Delete.style.display = "none";
            }
            if (event.target == modal_pdf_edit) {
                modal_pdf_edit.style.display = "none";
            }
            if (event.target == modal_Delete_pdf) {
                modal_Delete_pdf.style.display = "none";
            }
            if (event.target == modal_Delete_quiz) {
                modal_Delete_quiz.style.display = "none";
            }
        }

        $(document).on('click', '.editquiz', async function () {
            var modal_edit_quiz = document.getElementById("myModal_quiz_edit");
            modal_edit_quiz.style.display = "block";
            document.getElementById("quiz_edit_elements").innerHTML = renderedit_quiz();
            var current_quiz_id = sessionStorage.getItem("quiz_id");
            quiz_preview_data = { time: "", count: "", name: "", repeat: false, free: false, timer: false }
            question_arr_prev = [];
            await getquizdata();
            ////console.log(quiz_preview_data);
            if (quiz_preview_data.time != 0) {
                document.getElementById("quiz_time_div_edit").style.display = "block";
                document.getElementById("quiz_time_edit").value = quiz_preview_data.time;

            }
            else {
                document.getElementById("quiz_time_div_edit").style.display = "none";
            }
            document.getElementById("quiz_name_edit").value = quiz_preview_data.name;

            var free = quiz_preview_data.free;
            var timer = quiz_preview_data.timer;
            var repeat = quiz_preview_data.repeat;
            if (free == true) {
                document.getElementById("enroll_edit").checked = true;
                document.getElementById("enroll_edit").value = true;
            }
            else {
                document.getElementById("enroll_edit").checked = false;
                document.getElementById("enroll_edit").value = false;
            }
            if (timer == true) {
                document.getElementById("time_edit").checked = true;
                document.getElementById("time_edit").value = true;
            }
            else {
                document.getElementById("time_edit").checked = false;
                document.getElementById("time_edit").value = false;
            }
            if (repeat == true) {
                document.getElementById("repeat_edit").checked = true;
                document.getElementById("repeat_edit").value = true;
            }
            else {
                document.getElementById("repeat_edit").checked = false;
                document.getElementById("repeat_edit").value = false;
            }

        })

        $(document).on('click', '.question_div', async function () {

            current_choise_index_edit = 1
            let Course_id = sessionStorage.getItem("lec_id");
            let quiz_id = sessionStorage.getItem("quiz_id");
            let question_id = this.id
            sessionStorage.setItem("question_id", question_id)
            const question_course_query = query(collection(db, "courses", Course_id, "exams", quiz_id, "questions"), where("id", "==", question_id));
            let question_data = await retrivequiers(question_course_query);
            ////console.log(question_data);
            var quiz = "<div class=\"form-group\" style=\"text-align:center ;\">"
            quiz += "<input type=\"text\" class=\"form-control\" id=\"question_edit\" value=\" " + question_data[0].question + "\" placeholder=\"سؤال\">"
            quiz += "</div>"
            quiz += "<h4 class=\"right\">choices</h4>"
            quiz += "<fieldset id=\"choices_edit\" class=\"form-group\">"
            question_data[0].options.forEach((ques) => {
                quiz += "<div class=\"form-check flex\">"
                quiz += "<input type=\"text\" class=\"form-control\" id=\"quiz_choise_" + current_choise_index_edit + "\" value=\"" + ques + "\" placeholder=\"اختيار\">"
                if (question_data[0].correctAnswer == ques) {
                    quiz += "<input class=\"form-check-input\" type=\"radio\" name=\"gridRadios\" id=\"quiz_check_" + current_choise_index_edit + "\" value=\"" + current_choise_index_edit + "\" checked>"
                }
                else {
                    quiz += "<input class=\"form-check-input\" type=\"radio\" name=\"gridRadios\" id=\"quiz_check_" + current_choise_index_edit + "\" value=\"" + current_choise_index_edit + "\">"
                }
                quiz += "</div>"


                current_choise_index_edit++;
            });

            quiz += "</fieldset>"
            quiz += "<p class=\"validation\" id=\"valid_choice\">املءالاختيارات لاضافة اختيار جديد</p>"
            quiz += "<a href=\"#\" id=\"add_choices_edit\" class=\"ahref\">اضافة اختيار <span class=\"material-symbols-sharp\">add</span></a>"
            quiz += "<p class=\"validation\" id=\"quiz_validation_edit\">All fields must be filled out</p>"
            quiz += "<div class=\"centertwo\">"
            quiz += "<button type=\"button\"  id=\"quiz_edit_back2\" class=\"btn btn-primary\">Back</button>"
            quiz += "<button id=\"update_back2\" type=\"button\"  class=\"btn btn-primary\">Update Question</button>"
            quiz += "</div>"
            document.getElementById("quiz_edit_elements").innerHTML = quiz;
        })

        $(document).on('click', '#edit_questions', async function () {
            quiz_preview_data = { time: "", count: "", name: "", repeat: false, free: false, timer: false }
            question_arr_prev = [];
            await getquizdata();
            var question = "<h2 class=\"title_edit_quiz\"> <span id=\"add_quiz_edit\" class=\"material-symbols-sharp\">add</span>تعديل واضافة اسئلة</h2>"

            question_arr_prev.forEach((ques) => {
                question += "<div id=\"" + ques.id + "\" class=\"question_div\">"
                question += " <p>" + ques.question + "</p>"
                question += "</div>";
            });
            question += "<div class=\"form-group\" id=\"grid\"><button type=\"button\" id=\"back_edit_quiz\" class=\"btn btn-primary\">Back</button></div>"
            document.getElementById("quiz_edit_elements").innerHTML = question;
        })
        function renderedit_quiz() {
            var quiz_Edit_html = "<div class=\"form-group\" style=\"text-align:center ;\">"
            quiz_Edit_html += "<label for=\"inputEmail4\">quiz title</label>"
            quiz_Edit_html += "<input type=\"text\" class=\"form-control\" id=\"quiz_name_edit\" placeholder=\"عنوان الامتحان\">"
            quiz_Edit_html += " <p class=\"validation\" id=\"quiz_name_validation_edit\">Quiz title must be filled out</p>"
            quiz_Edit_html += "</div>"
            quiz_Edit_html += "<div class=\"form-group\" id=\"quiz_time_div_edit\" style=\"text-align:center ;\">"
            quiz_Edit_html += "<label for=\"inputEmail4\">Quiz time</label>"
            quiz_Edit_html += "<input type=\"text\" class=\"form-control\" id=\"quiz_time_edit\" placeholder=\"الوقت بالدقايق\">"
            quiz_Edit_html += "<p class=\"validation\" id=\"quiz_time_validation_edit\">Quiz Time must be filled out </p></div>"
            quiz_Edit_html += "<div class=\"form-group\">"
            quiz_Edit_html += "<div class=\"form-check\">"
            quiz_Edit_html += "<input class=\"form-check-input\" type=\"checkbox\" value=\"false\" id=\"enroll_edit\">"
            quiz_Edit_html += " <label class=\"form-check-label\" for=\"flexCheckDefault\">هل الامتحان يتطلب التسجيل بالكورس ؟</label>"
            quiz_Edit_html += "</div>"
            quiz_Edit_html += "<div class=\"form-check\">"
            quiz_Edit_html += "<input class=\"form-check-input\" type=\"checkbox\" value=\"true\" id=\"repeat_edit\">"
            quiz_Edit_html += "<label class=\"form-check-label\" for=\"flexCheckDefault\"> هل يمكن اعادة الامتحان ؟</label>"
            quiz_Edit_html += "</div>"
            quiz_Edit_html += "<div class=\"form-check\">"
            quiz_Edit_html += "<input class=\"form-check-input\" type=\"checkbox\" value=\"true\" id=\"time_edit\">"
            quiz_Edit_html += "<label class=\"form-check-label\" for=\"flexCheckDefault\">"
            quiz_Edit_html += "  هل الامتحان وقت معين ؟"
            quiz_Edit_html += " </label> </div>  </div>"
            quiz_Edit_html += " <div class=\"form-group\" id=\"flex_between\">"
            quiz_Edit_html += "<button type=\"button\" id=\"edit_questions\" class=\"btn btn-primary\">EditQuestions</button>"
            quiz_Edit_html += " <button type=\"button\" id=\"update_quiz\" class=\"btn btn-primary\">Save</button> </div>"
            return quiz_Edit_html;
        }
        $(document).on('click', '#back_edit_quiz', async function () {

            var modal_edit_quiz = document.getElementById("myModal_quiz_edit");
            modal_edit_quiz.style.display = "block";
            document.getElementById("quiz_edit_elements").innerHTML = renderedit_quiz();
            var current_quiz_id = sessionStorage.getItem("quiz_id");
            quiz_preview_data = { time: "", count: "", name: "", repeat: false, free: false, timer: false }
            question_arr_prev = [];
            await getquizdata();
            ////console.log(quiz_preview_data);
            if (quiz_preview_data.time != 0) {
                document.getElementById("quiz_time_div_edit").style.display = "block";
                document.getElementById("quiz_time_edit").value = quiz_preview_data.time;

            }
            else {
                document.getElementById("quiz_time_div_edit").style.display = "none";
            }
            document.getElementById("quiz_name_edit").value = quiz_preview_data.name;

            var free = quiz_preview_data.free;
            var timer = quiz_preview_data.timer;
            var repeat = quiz_preview_data.repeat;
            if (free == true) {
                document.getElementById("enroll_edit").checked = true;
                document.getElementById("enroll_edit").value = true;
            }
            else {
                document.getElementById("enroll_edit").checked = false;
                document.getElementById("enroll_edit").value = false;
            }
            if (timer == true) {
                document.getElementById("time_edit").checked = true;
                document.getElementById("time_edit").value = true;
            }
            else {
                document.getElementById("time_edit").checked = false;
                document.getElementById("time_edit").value = false;
            }
            if (repeat == true) {
                document.getElementById("repeat_edit").checked = true;
                document.getElementById("repeat_edit").value = true;
            }
            else {
                document.getElementById("repeat_edit").checked = false;
                document.getElementById("repeat_edit").value = false;
            }
        })

        $(document).on('click', '#add_quiz_edit', async function () {

            current_choise_index_edit = 1
            var quiz = "<div class=\"form-group\" style=\"text-align:center ;\">"
            quiz += "<input type=\"text\" class=\"form-control\" id=\"question_edit\" placeholder=\"سؤال\">"
            quiz += "</div>"
            quiz += "<h4 class=\"right\">choices</h4>"
            quiz += "<fieldset id=\"choices_edit\" class=\"form-group\">"
            quiz += "<div class=\"form-check flex\">"
            quiz += "<input type=\"text\" class=\"form-control\" id=\"quiz_choise_" + current_choise_index_edit + "\" placeholder=\"اختيار\">"
            quiz += "<input class=\"form-check-input\" type=\"radio\" name=\"gridRadios\" id=\"quiz_check_" + current_choise_index_edit + "\" value=\"" + current_choise_index_edit + "\">"
            quiz += "</div>"
            current_choise_index_edit++;
            quiz += "<div class=\"form-check flex\">"
            quiz += "<input type=\"text\" class=\"form-control\" id=\"quiz_choise_" + current_choise_index_edit + "\" placeholder=\"اختيار\">"
            quiz += "<input class=\"form-check-input\" type=\"radio\" name=\"gridRadios\" id=\"quiz_check_" + current_choise_index_edit + "\" value=\"" + current_choise_index_edit + "\">"
            quiz += "</div>"
            current_choise_index_edit++;
            quiz += "</fieldset>"
            quiz += "<p class=\"validation\" id=\"valid_choice\">املءالاختيارات لاضافة اختيار جديد</p>"
            quiz += "<a href=\"#\" id=\"add_choices_edit\" class=\"ahref\">اضافة اختيار <span class=\"material-symbols-sharp\">add</span></a>"
            quiz += "<p class=\"validation\" id=\"quiz_validation_edit\">All fields must be filled out</p>"
            quiz += "<div class=\"centertwo\">"
            quiz += "<button type=\"button\"  id=\"quiz_edit_back2\" class=\"btn btn-primary\">Back</button>"
            quiz += "<button id=\"add_back2\" type=\"button\"  class=\"btn btn-primary\">Add Question</button>"
            quiz += "</div>"
            document.getElementById("quiz_edit_elements").innerHTML = quiz;
        })
        $(document).on('click', '#add_choices_edit', function () {
            add_checkbox_edit();
        })
        function add_checkbox_edit() {


            var fieldset = document.getElementById("choices_edit");
            for (let i = 1; i < current_choise_index_edit; i++) {
                if (document.getElementById("quiz_choise_" + i).value == "") {
                    ////console.log("a7a")
                    document.getElementById("valid_choice").style.display = "block";
                    return;
                }
            }


            document.getElementById("valid_choice").style.display = "none";
            const div = document.createElement("div");
            div.setAttribute("class", "form-check flex");

            const input_text = document.createElement("input");
            input_text.setAttribute("type", "text");
            input_text.setAttribute("class", "form-control");
            input_text.setAttribute("placeholder", "اختيار");
            input_text.setAttribute("id", "quiz_choise_" + current_choise_index_edit);
            div.appendChild(input_text);

            const input_check = document.createElement("input");
            input_check.setAttribute("type", "radio");
            input_check.setAttribute("class", "form-check-input");
            input_check.setAttribute("name", "gridRadios");
            input_check.setAttribute("value", current_choise_index_edit);
            input_check.setAttribute("id", "quiz_check_" + current_choise_index_edit);
            div.appendChild(input_check);
            fieldset.appendChild(div);

            current_choise_index_edit++;
        }

        $(document).on('click', '#quiz_edit_back2', async function () {
            quiz_preview_data = { time: "", count: "", name: "", repeat: false, free: false, timer: false }
            question_arr_prev = [];
            await getquizdata();
            var question = "<h2 class=\"title_edit_quiz\"> <span id=\"add_quiz_edit\" class=\"material-symbols-sharp\">add</span>تعديل واضافة اسئلة</h2>"

            question_arr_prev.forEach((ques) => {
                question += "<div id=\"" + ques.id + "\" class=\"question_div\">"
                question += " <p>" + ques.question + "</p>"
                question += "</div>";
            });
            question += "<div class=\"form-group\" id=\"grid\"><button type=\"button\" id=\"back_edit_quiz\" class=\"btn btn-primary\">Back</button></div>"
            document.getElementById("quiz_edit_elements").innerHTML = question;
        })

        $(document).on('click', '#update_back2', async function () {
            document.getElementById("valid_choice").style.display = "none";
            if (question_validation_edit() == true) {
                if (radio_buttons_validation() == true) {
                    document.getElementById("quiz_validation_edit").style.display = "none";
                    let Course_id = sessionStorage.getItem("lec_id");
                    let quiz_id = sessionStorage.getItem("quiz_id");
                    let question_id = sessionStorage.getItem("question_id");
                    var answers = new Array();
                    var index = 1;
                    var correct_answer_index;
                    const radioButtons = document.querySelectorAll('input[name="gridRadios"]');

                    var question = document.getElementById("question_edit").value;
                    for (let i = 0; i < current_choise_index_edit - 1; i++) {
                        var choice = document.getElementById("quiz_choise_" + index).value;
                        if (choice != "") {
                            answers.push(choice);
                        }
                        index++;
                    }

                    for (const radioButton of radioButtons) {
                        if (radioButton.checked) {
                            correct_answer_index = radioButton.value;
                        }
                    }
                    const questionRef = doc(db, "courses", Course_id, "exams", quiz_id, "questions", question_id);
                    var correct = document.getElementById("quiz_choise_" + correct_answer_index).value;
                    await updateDoc(questionRef, {
                        correctAnswer: correct,
                        options: answers,
                        question: question,
                    });




                    quiz_preview_data = { time: "", count: "", name: "", repeat: false, free: false, timer: false }
                    question_arr_prev = [];
                    await getquizdata();
                    var question = "<h2 class=\"title_edit_quiz\"> <span id=\"add_quiz_edit\" class=\"material-symbols-sharp\">add</span>تعديل واضافة اسئلة</h2>"

                    question_arr_prev.forEach((ques) => {
                        question += "<div id=\"" + ques.id + "\" class=\"question_div\">"
                        question += " <p>" + ques.question + "</p>"
                        question += "</div>";
                    });
                    question += "<div class=\"form-group\" id=\"grid\"><button type=\"button\" id=\"back_edit_quiz\" class=\"btn btn-primary\">Back</button></div>"
                    document.getElementById("quiz_edit_elements").innerHTML = question;
                    await render_quiz(current_quiz_page);
                    alert("تم تعديل السؤال بنجاح");
                }
                else {
                    document.getElementById("quiz_validation_edit").innerHTML = "one check box at least must be cheacked";
                    document.getElementById("quiz_validation_edit").style.display = "block";
                }
            }
            else {
                document.getElementById("quiz_validation_edit").innerHTML = "All fields must be filled out";
                document.getElementById("quiz_validation_edit").style.display = "block";
            }

        })

        $(document).on('click', '#add_back2', async function () {
            document.getElementById("valid_choice").style.display = "none";
            if (question_validation_edit() == true) {
                if (radio_buttons_validation() == true) {
                    document.getElementById("quiz_validation_edit").style.display = "none";
                    let Course_id = sessionStorage.getItem("lec_id");
                    let quiz_id = sessionStorage.getItem("quiz_id");
                    var answers = new Array();
                    var index = 1;
                    var correct_answer_index;
                    const radioButtons = document.querySelectorAll('input[name="gridRadios"]');

                    var question = document.getElementById("question_edit").value;
                    for (let i = 0; i < current_choise_index_edit - 1; i++) {
                        var choice = document.getElementById("quiz_choise_" + index).value;
                        if (choice != "") {
                            answers.push(choice);
                        }

                        index++;
                    }

                    for (const radioButton of radioButtons) {
                        if (radioButton.checked) {
                            correct_answer_index = radioButton.value;
                        }
                    }
                    var correct = document.getElementById("quiz_choise_" + correct_answer_index).value;
                    const question_course_query = query(collection(db, "courses", Course_id, "exams", quiz_id, "questions"));
                    let question_data = await retrivequiers(question_course_query);
                    var sort = parseInt(question_data.length + 1);

                    const questionRef = await addDoc(collection(db, "courses", Course_id, "exams", quiz_id, "questions"), {
                        correctAnswer: correct,
                        options: answers,
                        question: question,
                        sortValue: sort,
                    });
                    const washingtonRef = doc(db, "courses", Course_id, "exams", quiz_id, "questions", questionRef.id);
                    await updateDoc(washingtonRef, {
                        id: questionRef.id
                    });
                    quiz_preview_data = { time: "", count: "", name: "", repeat: false, free: false, timer: false }
                    question_arr_prev = [];
                    await getquizdata();
                    var question = "<h2 class=\"title_edit_quiz\"> <span id=\"add_quiz_edit\" class=\"material-symbols-sharp\">add</span>تعديل واضافة اسئلة</h2>"

                    question_arr_prev.forEach((ques) => {
                        question += "<div id=\"" + ques.id + "\" class=\"question_div\">"
                        question += " <p>" + ques.question + "</p>"
                        question += "</div>";
                    });
                    question += "<div class=\"form-group\" id=\"grid\"><button type=\"button\" id=\"back_edit_quiz\" class=\"btn btn-primary\">Back</button></div>"
                    document.getElementById("quiz_edit_elements").innerHTML = question;
                    await render_quiz(current_quiz_page);
                    alert("تم اضافة السؤال بنجاح");
                }
                else {
                    document.getElementById("quiz_validation_edit").innerHTML = "one check box at least must be cheacked";
                    document.getElementById("quiz_validation_edit").style.display = "block";
                }
            }
            else {
                document.getElementById("quiz_validation_edit").innerHTML = "All fields must be filled out";
                document.getElementById("quiz_validation_edit").style.display = "block";
            }


        })

        function question_validation_edit() {

            var question_value = document.getElementById("question_edit").value;
            var answers = new Array();
            var index = 1;


            for (let i = 0; i < current_choise_index_edit - 1; i++) {

                var choice = document.getElementById("quiz_choise_" + index).value;
                answers.push(choice);
                index++;
            }


            for (var i = 0; i < answers.length; i++) {
                if (answers[i] === "") {
                    document.getElementById("quiz_validation_edit").style.display = "block";
                    return false;
                }
            }

            if (question_value == "") {
                document.getElementById("quiz_validation_edit").style.display = "block";
                return false;
            }
            document.getElementById("quiz_validation_edit").style.display = "none";
            return true;

        }

        $(document).on('click', '#update_quiz', async function () {
            var quiz_name_value = document.getElementById("quiz_name_edit").value;
            var time_value;
            var time_Check = document.getElementById("time_edit");
            CheckBox(time_Check);
            var time_check_bool = (time_Check.value === "true");

            var enroll_Check = document.getElementById("enroll_edit");
            CheckBox(enroll_Check);
            var enroll_Check_bool = (enroll_Check.value === "true");

            var repeat_Check = document.getElementById("repeat_edit");
            CheckBox(repeat_Check);
            var repeat_Check_bool = (repeat_Check.value === "true");
            let Course_id = sessionStorage.getItem("lec_id");
            let quiz_id = sessionStorage.getItem("quiz_id");

            if (quiz_name_value != "" && validate_quiz_time_edit() == true) {
                const checkbox = document.getElementById('time_edit');
                if (checkbox.checked) {
                    time_value = parseInt(document.getElementById("quiz_time_edit").value);
                }
                else {
                    time_value = 0
                }
                const quiz_ref = doc(db, "courses", Course_id, 'exams', quiz_id);
                await updateDoc(quiz_ref, {
                    canRepeat: repeat_Check_bool,
                    free: enroll_Check_bool,
                    withTimer: time_check_bool,
                    name: quiz_name_value,
                    timeInMinutes: time_value,
                });

            }
            else {
                if (quiz_name_value != "") {
                    document.getElementById("quiz_name_validation_edit").style.display = "none";
                }
                else {
                    document.getElementById("quiz_name_validation_edit").style.display = "block";
                }

            }
            await render_quiz(current_quiz_page);
            alert("تم تعديل الامتحان بنجاح");
        })
        function validate_quiz_time_edit() {

            const checkbox = document.getElementById('time_edit');
            const quiz_time_value = document.getElementById("quiz_time_edit").value;
            if (checkbox.checked) {

                if (quiz_time_value != "") {

                    var valueInt = parseInt(quiz_time_value)
                    ////console.log(valueInt);
                    if (valueInt < 5 || valueInt > 100) {

                        document.getElementById("quiz_time_validation_edit").innerHTML = " وقت للامتحان يتراوج من 5 دقائق الي 100 دقيقة";
                        document.getElementById("quiz_time_validation_edit").style.display = "block";
                        return false;
                    }
                    else {

                        return true;
                    }
                } else {

                    document.getElementById("quiz_time_validation").innerHTML = "Quiz Time must be filled out";
                    document.getElementById("quiz_time_validation").style.display = "block"
                    return false;
                }
            }
            else {

                return true;
            }
        }

        // delete quiz 
        $(document).on('click', '.deletebtn_quiz', async function () {
            var quiz_id = sessionStorage.getItem("quiz_id");
            var Course_id = sessionStorage.getItem("lec_id");
            var modal_Delete = document.getElementById('myModal_quiz_delete');
            await deleteDoc(doc(db, "courses", Course_id, "exams", quiz_id));
            modal_Delete.style.display = "none";
            await render_quiz(current_quiz_page);
            alert("تم مسح الكويز بنجاح ");
        });

        //edit course
        $(document).on('click', '.editcourse', async function () {
            await rendercourse(current_corse_page);
            await setdata_quiz_edit()
        })
        async function setdata_quiz_edit() {
            const myNode = document.getElementById("cat_Select_edit");
            myNode.innerHTML = '';
            var disbaledd = document.getElementById("hidecat_edit");
            var subcatg = document.getElementById("subcat_edit");
            var course_id = sessionStorage.getItem("course_id");
            const course_query = query(collection(db, "courses"), where("id", "==", course_id));
            let courses_Data = await retrivequiers(course_query);
            document.getElementById("course_name_edit").value = courses_Data[0].courseName;
            document.getElementById("course_price_edit").value = courses_Data[0].price;
            document.getElementById("course_desc_edit").value = courses_Data[0].desc;

            var select = document.getElementById("cat_Select_edit");
            for (var i = 0; i < catgory_data.length; i++) {
                if (courses_Data[0].categoryId == catgory_data[i].id) {
                    var opt = catgory_data[i].name;
                    var el = document.createElement("option");
                    el.textContent = opt;
                    el.value = catgory_data[i].id;
                    el.selected = true;
                    select.appendChild(el);
                }
                else {
                    var opt = catgory_data[i].name;
                    var el = document.createElement("option");
                    el.textContent = opt;
                    el.value = catgory_data[i].id;
                    select.appendChild(el);
                }
            }


            if (courses_Data[0].subCategoryId == "") {
                disbaledd.style.display = "block";
                subcatg.style.display = "none";
            } else {
                disbaledd.style.display = "none";
                subcatg.style.display = "block";
                var selectBox = document.getElementById("cat_Select_edit");
                var selectedValue = selectBox.value;
                const sub_catg = query(collection(db, "mainCategory", selectedValue, "subCategory"));
                let sub_catgory_data = await retrivequiers(sub_catg);
                var select = document.getElementById("subbcat_edit");
                for (var i = 0; i < sub_catgory_data.length; i++) {
                    if (courses_Data[0].subCategoryId == sub_catgory_data[i].id) {
                        var opt = sub_catgory_data[i].name;
                        var el = document.createElement("option");
                        el.textContent = opt;
                        el.value = sub_catgory_data[i].id;
                        el.selected = true;
                        ////console.log(select);
                        select.appendChild(el);
                    }
                    else {
                        var opt = sub_catgory_data[i].name;
                        var el = document.createElement("option");
                        el.textContent = opt;
                        el.value = sub_catgory_data[i].id;
                        ////console.log(select);
                        select.appendChild(el);
                    }
                }
            }
            const imagePreview_Edit = document.querySelector('[data-target="image-preview_edit"]');

            imagePreview_Edit.src = courses_Data[0].picUrl;


        }
        document.getElementById("cat_Select_edit").addEventListener("change", myFunctionnm);
        async function myFunctionnm() {
            var selectBox = document.getElementById("cat_Select_edit");
            var selectedValue = selectBox.value;
            var disbaledd = document.getElementById("hidecat_edit");
            var subcatg = document.getElementById("subcat_edit");
            const sub_catg = query(collection(db, "mainCategory", selectedValue, "subCategory"));
            let sub_catgory_data = await retrivequiers(sub_catg);
            ////console.log(sub_catgory_data);



            if (sub_catgory_data.length > 0) {
                var selectBox = document.getElementById("subbcat_edit");
                const select = document.querySelector('select');
                disbaledd.style.display = "block";
                subcatg.style.display = "none";
                var i, L = selectBox.options.length - 1;
                for (i = L; i >= 0; i--) {
                    selectBox.remove(i);
                }
                disbaledd.style.display = "none";
                subcatg.style.display = "block";
                fillselect("subbcat_edit", sub_catgory_data);
            }
            else {
                var selectBox = document.getElementById("subbcat_edit");
                const select = document.querySelector('select');
                disbaledd.style.display = "block";
                subcatg.style.display = "none";
                var i, L = selectBox.options.length - 1;
                for (i = L; i >= 0; i--) {
                    selectBox.remove(i);
                }
            }
        }
        function validete_edit_course() {
            var checkdata = false;
            //inputs
            const course_name = document.getElementById("course_name_edit");
            const course_price = document.getElementById("course_price_edit");
            const course_desc = document.getElementById("course_desc_edit");
            const course_catg = document.getElementById("cat_Select_edit");
            const course_sub_catg = document.getElementById("subbcat_edit");
            const course_img = document.getElementById("file-uploader_edit");

            // validates 
            const course_name_validation = document.getElementById("course_name_validation_edit");
            const course_price_validation = document.getElementById("price_validation_edit");
            const course_desc_validation = document.getElementById("course_description_validation_edit");
            const course_catg_validation = document.getElementById("catagory_validation_edit");
            const course_sub_catg_validation = document.getElementById("sub_catagory_validation_edit");
            const course_img_validation = document.getElementById("image_catagory_validation_edit");
            if (course_name.value == "") {
                course_name_validation.style.display = "block";
                return false;
            }
            else {
                course_name_validation.style.display = "none";
                checkdata = true;
            }


            if (course_price.value == "") {
                course_price_validation.style.display = "block";
                return false;
            }
            else {
                course_price_validation.style.display = "none";
                checkdata = true;

            }


            if (course_desc.value == "") {
                course_desc_validation.style.display = "block";
                return false;
            }
            else {
                course_desc_validation.style.display = "none";
                checkdata = true;

            }


            if (course_catg.value == "" && course_catg.style.display == "block") {
                course_catg_validation.style.display = "block";
                return false;
            }
            else {
                course_catg_validation.style.display = "none";
                checkdata = true;

            }


            if (course_sub_catg.value == "") {
                course_sub_catg_validation.style.display = "block";
                return false;
            }
            else {
                course_sub_catg_validation.style.display = "none";
                checkdata = true;

            }



            return checkdata;
        }
        async function upload_img_edit() {
            var course_id = sessionStorage.getItem("course_id");
            const course_name = document.getElementById("course_name_edit").value;
            const course_price = document.getElementById("course_price_edit").value;
            const course_desc = document.getElementById("course_desc_edit").value;
            const course_catg = document.getElementById("cat_Select_edit").value;
            const course_sub_catg = document.getElementById("subbcat_edit").value;


            const courseref = doc(db, "courses", course_id);
            if (validete_edit_course() == true) {
                const fileSelector = document.getElementById('file-uploader_edit').files[0];
                if (document.getElementById('file-uploader_edit').files.length == 0) {
                    await updateDoc(courseref, {

                        categoryId: course_catg,
                        courseName: course_name,
                        desc: course_desc,

                        price: parseInt(course_price),
                        subCategoryId: course_sub_catg,
                    });
                } else {
                    var course_id = sessionStorage.getItem("course_id");
                    var storageRef = sRef(storage, "courses/" + course_id + "/" + "thumb.jpg");
                    const uploadTask = uploadBytesResumable(storageRef, fileSelector);

                    uploadTask.on('state_changed',
                        (snapshot) => {
                            // Observe state change events such as progress, pause, and resume
                            // Get task progress, including the number of bytes uploaded and the total number of bytes to be uploaded
                            ////console.log(snapshot.bytesTransferred);
                            ////console.log(snapshot.totalBytes);
                            updateProgressPdf(snapshot.bytesTransferred / snapshot.totalBytes)

                        },
                        (error) => {

                        },
                        async () => {

                            const download_url = await getDownloadURL(uploadTask.snapshot.ref);

                            // Set the "capital" field of the city 'DC'
                            await updateDoc(courseref, {

                                categoryId: course_catg,
                                courseName: course_name,
                                desc: course_desc,
                                picUrl: download_url,
                                price: parseInt(course_price),
                                subCategoryId: course_sub_catg,
                            });








                        }
                    );
                }
                alert("تم تعديل الكورس بنجاح");
                document.getElementById("myModal_course_edit").style.display = "none";
            }

            else {
                return;
            }

        }
        document.getElementById("update_course").onclick = async () => {
            await upload_img_edit();
        };


        //delete course
        $(document).on('click', '.delete_coursee', async function () {
            var Course_id = sessionStorage.getItem("course_id");
            await deleteDoc(doc(db, "courses", Course_id));
            document.getElementById("myModal_course_delete").style.display = "none";
            await rendercourse(current_corse_page);

            var indexs = await numberofpage();
            for (var i = 1 ; i <=indexs ; i++){
                await rendercourse(i);
            }   

            alert("تم مسح الكورس بنجاح ");
            document.getElementById("backToCourses").click();
        });


        // settings genreal functions 
        function validateEditInfo() {
            var check = false;
            var name = document.getElementById("setting_name").value;
            var bio = document.getElementById("setting_bio").value;
            var phone = document.getElementById("setting_phone").value;
            var name_valid = document.getElementById("setting_name_valid");
            var bio_valid = document.getElementById("setting_bio_valid");
            var phone_valid = document.getElementById("setting_phone_valid");
            var phone2_valid = document.getElementById("setting_phone2_valid");

            if (name == "") {
                console.log("a7a");
                name_valid.style.display = "block";
                return false;
            }
            else {
                name_valid.style.display = "none";
                check = true;
            }
            if (bio == "") {
                bio_valid.style.display = "block";
                return false;
            }
            else {
                bio_valid.style.display = "none";
                check = true;
            }
            if (phone == "") {
                phone_valid.style.display = "block";
                return false;
            }
            else {
                phone_valid.style.display = "none";
                if (phone.length != 11) {
                    phone2_valid.style.display = "block";
                    return false;
                }
                else {
                    phone2_valid.style.display = "none";
                    check = true;
                }
            }
            return check;
        }
        document.getElementById('pp_edit_img').onchange = function (evt) {
            var tgt = evt.target || window.event.srcElement,
                files = tgt.files;

            // FileReader support
            if (FileReader && files && files.length) {
                var fr = new FileReader();
                fr.onload = function () {
                    document.getElementById("pp_img").src = fr.result;
                }
                fr.readAsDataURL(files[0]);
            }

            // Not supported
            else {
                // fallback -- perhaps submit the input to an iframe and temporarily store
                // them on the server until the user's session ends.
            }
        }
        document.getElementById('cover_edit_img').onchange = function (evt) {
            var tgt = evt.target || window.event.srcElement,
                files = tgt.files;

            // FileReader support
            if (FileReader && files && files.length) {
                var fr = new FileReader();
                fr.onload = function () {
                    document.getElementById("cover_img").src = fr.result;
                }
                fr.readAsDataURL(files[0]);
            }

            // Not supported
            else {
                // fallback -- perhaps submit the input to an iframe and temporarily store
                // them on the server until the user's session ends.
            }
        }
        $(document).on('click', '#update_info_setting', async function () {
            var name1 = document.getElementById("setting_name").value;
            var bio1 = document.getElementById("setting_bio").value;
            var phone1 = document.getElementById("setting_phone").value;
            var cover_input = document.getElementById('cover_edit_img');
            var pp_input = document.getElementById('pp_edit_img');
            var cover = document.getElementById("cover_img").src;
            var pp = document.getElementById("pp_img").src;
            const user_uid = await userUid();
            if (cover_input.files.length != 0) {
                var storageRef = sRef(storage, 'users/' + user_uid + "_" + "cover" + '.jpg');
                cover = await upload_to_storage(storageRef, cover_input.files[0]);
            }
            if (pp_input.files.length != 0) {
                var storageRef = sRef(storage, 'users/' + user_uid + "_" + "pp" + '.jpg');
                pp = await upload_to_storage(storageRef, pp_input.files[0]);
            }

            if (validateEditInfo() == true) {
                $('#loading_spiner').show();
                const washingtonRef = doc(db, "users", user_uid);
                await updateDoc(washingtonRef, {
                    name: name1,
                    bio: bio1,
                    phone: phone1,
                    ppUrl: pp,
                    coverUrl: cover,
                });
                $('#loading_spiner').fadeOut();
                alert("تم تعديل البيانات بنجاح ");

            }
            else {
                $('#loading_spiner').fadeOut();
                return;
            }

        })

        //settings password functions
        function validatepassInfo() {
            var check = false;
            var pass = document.getElementById("new_pass").value;
            var pass2 = document.getElementById("new_pass_cofrm").value;

            var pass_valid = document.getElementById("pass_valid");
            var pass2_valid = document.getElementById("pass2_valid");
            var pass3_valid = document.getElementById("pass3_valid");


            if (pass == "") {

                pass_valid.style.display = "block";
                return false;
            }
            else {
                pass_valid.style.display = "none";
                check = true;
            }
            if (pass2 == "") {
                pass_valid.style.display = "block";
                return false;
            }
            else {
                pass2_valid.style.display = "none";
                check = true;
            }
            if (pass != pass2) {
                pass2_valid.style.display = "block";
                return false;
            }
            else {
                pass2_valid.style.display = "none";
                check = true;
            }
            if (pass.length < 6) {
                pass3_valid.style.display = "block";
                return false;
            } else {
                pass3_valid.style.display = "none";
                check = true;
            }


            return check;
        }
        async function validateOldPass() {
            const user = auth.currentUser;
            const docRef = doc(db, "users", user.uid);
            const docSnap = await getDoc(docRef);
            const doc_data = docSnap.data();
            if (document.getElementById("old_pass").value == "") {
                document.getElementById("pass_valid").style.display = "block";
                return false;
            }
            if (document.getElementById("old_pass").value != doc_data.pass) {
                console.log("old pass :", document.getElementById("old_pass").value);
                console.log(" pass :", user.pass);
                document.getElementById("pass_old").style.display = "block";
                return false;
            }
            else {
                document.getElementById("pass_valid").style.display = "none";
                document.getElementById("pass_old").style.display = "none";
                return true;
            }


        }
        $(document).on('click', '#update_paswword', async function () {
            var old_pass_Show = document.getElementById("old_pass").style.getPropertyValue('display');
            var old_pass = document.getElementById("old_pass").value;
            var new_pass = document.getElementById("new_pass").value;
            var new_pass_cofrm = document.getElementById("new_pass_cofrm").value;
            const user = auth.currentUser;
            if (old_pass_Show == "block") {
                console.log("show")
                if (validatepassInfo() == true && await validateOldPass() == true) {
                    console.log("show")
                    var credentiall = EmailAuthProvider.credential(user.email, old_pass)
                    console.log(credentiall);
                    reauthenticateWithCredential(user, credentiall).then(() => {
                        console.log(credentiall);
                        console.log(parseInt(new_pass));
                        updatePassword(user, new_pass).then(() => {
                            console.log("show")
                            old_pass = "";
                            new_pass = "";
                            new_pass_cofrm = "";
                            alert("تم انشاء كلمة المرور")
                        }).catch((error) => {
                            console.log("show")
                            console.log(error)
                            alert(error);
                            return;
                        });
                    }).catch((error) => {
                        console.log("show")
                        alert(error);
                        console.log(error);
                        return;

                    });
                    const washingtonRef = doc(db, "users", user.uid);
                    await updateDoc(washingtonRef, {
                        pass: new_pass
                    });
                }
            }


            else {
                if (validatepassInfo() == true) {
                    updatePassword(user, new_pass).then(() => {
                        old_pass = "";
                        new_pass = "";
                        new_pass_cofrm = "";
                        alert("تم انشاء كلمة المرور")
                    }).catch((error) => {
                        alert(error);
                        return;
                    });
                    const washingtonRef = doc(db, "users", user.uid);
                    await updateDoc(washingtonRef, {
                        pass: new_pass
                    });
                }

            }
        })


        //settings asstant functions
        function validateAsstInfo() {
            var check = false;
            var email = document.getElementById("asst_email").value;
            var name = document.getElementById("asst_name").value;
            var phone = document.getElementById("asst_phone").value;
            var email_valid = document.getElementById("asst_email_valid");
            var name_valid = document.getElementById("asst_name_valid");
            var phone_valid = document.getElementById("asst_phone_valid");
            var phone2_valid = document.getElementById("asst_phone2_valid");

            if (email == "") {
                console.log("a7a");
                email_valid.style.display = "block";
                return false;
            }
            else {
                email_valid.style.display = "none";
                check = true;
            }
            if (name == "") {
                name_valid.style.display = "block";
                return false;
            }
            else {
                name_valid.style.display = "none";
                check = true;
            }
            if (phone == "") {
                phone_valid.style.display = "block";
                return false;
            }
            else {
                phone_valid.style.display = "none";
                check = true;
            }
            console.log(phone.length)
            if (phone.length != 11) {
                phone2_valid.style.display = "block";
                return false;
            }
            else {
                phone2_valid.style.display = "none";
                check = true;
            }
            return check;
        }
        $(document).on('click', '#create_asst', async function () {
            var email1 = document.getElementById("asst_email").value;
            var name1 = document.getElementById("asst_name").value;
            var phone1 = document.getElementById("asst_phone").value;
            const user_uid = await userUid();
            console.log(name1, email1, phone1, user_uid);
            if (validateAsstInfo() == true) {
                $('#loading_spiner').show();
                const asstanint = httpsCallable(functions, 'createAssistantAccount');
                asstanint({ managerId: user_uid, name: name1, email: email1, phone: phone1, type: "assistant" })
                    .then((result) => {

                        $('#loading_spiner').fadeOut();
                        console.log(result);
                        document.getElementById("asst_email").value = "";
                        document.getElementById("asst_name").value = "";
                        document.getElementById("asst_phone").value = "";
                        getUserData(user_uid)
                        alert(result.data.message);
                    })
            }
            else {

            }
        })


        $(document).on('change', '.active_asst', async function (event) {
            var id = sessionStorage.getItem("asst_id");
            const asst = doc(db, "users", id);
            if (event.currentTarget.checked) {
                await updateDoc(asst, {
                    active: true
                });
                alert('تم تفعيل المساعد');
            } else {
                await updateDoc(asst, {
                    active: false
                });
                alert('تم تعطيل المساعد');
            }
        })

        //setting send notifictions 
        function validatenotifi() {
            var noti_input = document.getElementById("noti_input").value;
            var noti_valid = document.getElementById("noti_valid");


            if (noti_input == "") {
                console.log("a7a");
                noti_valid.style.display = "block";
                return false;
            }
            else {
                noti_valid.style.display = "none";
                return true;
            }

        }
        $(document).on('click', '#send_noti', async function () {
            var noti_input = document.getElementById("noti_input").value;
            const user_uid = await userUid();
            console.log(user_uid);
            console.log(noti_input);
            if (validatenotifi() == true) {
                $('#loading_spiner').show();
                const noti = httpsCallable(functions, 'sendNotificationToFollowers');
                noti({ textAction: noti_input, from: user_uid })
                    .then((result) => {

                        $('#loading_spiner').fadeOut();
                        document.getElementById("noti_input").value = ""
                        alert("تم ارسال اشعار لجميع متابعينك");
                    })
                    .catch((error) => {
                        // Getting the Error details.
                        const code = error.code;
                        const message = error.message;
                        const details = error.details;
                        $('#loading_spiner').fadeOut();
                        console.log(error);
                        alert("حدث خطاء ما");
                    });
            }
            else {

            }
        })
        function upload_to_storage(storageRef, file) {
            return new Promise((resolve, reject) => {
                const uploadTask = uploadBytesResumable(storageRef, file);
                uploadTask.on('state_changed',
                    (snapshot) => {

                    },
                    (error) => {
                        // Handle unsuccessful uploads
                    },
                    async () => {
                        const download_url = await getDownloadURL(uploadTask.snapshot.ref);
                        resolve(download_url);
                    }
                );
            })
        }

        //setting wallet show more 
        $(document).on('click', '.show_more', async function () {
            const user_uidd = await userUid();
            var last_date = JSON.parse(sessionStorage.getItem("last_doc"))
            console.log(last_date);
            var wallet_query2 = query(collection(db, "users", user_uidd, "transactions"), orderBy("date", "desc"), startAfterr(last_date), limit(10));
            var wallet_data2 = await retrivequiers(wallet_query2);
            console.log(wallet_data2);
            var tr = ""
            var data = document.getElementById("wallet_rows").innerHTML;
            wallet_data2.forEach((row) => {
                tr += "<tr>"
                var date = toDateTime(row.date.seconds);
                date = formatDate(date);
                if (row.amount < 0) {
                    tr += "<td class=\"text-danger\"> " + row.amount + "<span>Egp<span> <i class=\"fa fa-arrow-down\"></i></td>"
                } else {
                    tr += "<td class=\"text-success\"> " + row.amount + "<span>Egp<span> <i class=\"fa fa-arrow-up\"></i></td>"
                }
                tr += "<td>" + date + "</td>"
                tr += "<td>" + row.desc + "</td>"
                tr += "</tr>"

            })
            document.getElementById("wallet_rows").innerHTML = data + tr;

        })

        window.onload = async function () {

            google.accounts.id.initialize({
                client_id: "327935716338-34ihu5mladhpjck75s8rvu56p2s7uugh.apps.googleusercontent.com",
                callback: await handleCredentialResponse
            });
            google.accounts.id.renderButton(
                document.getElementById("buttonDiv"),
                { theme: "outline", size: "large" }  // customization attributes
            );

        }
        async function handleCredentialResponse(response) {
            // Build Firebase credential with the Google ID token.
            const idToken = response.credential;
            const credential = GoogleAuthProvider.credential(idToken);
            const user = parseJwt(response.credential);
            const googleId = user.sub;
            var error2 = false
            const credential2 = GoogleAuthProvider.credential(credential.idToken);
            console.log(auth.currentUser);
            console.log(credential2);
            linkWithCredential(auth.currentUser, credential2)
                .then((usercred) => {
                    const user = usercred.user;
                    console.log("Account linking success", user);
                    error2 = false;
                }).catch((error) => {
                    alert("Account linking error", error);
                    console.log(error);
                    error2 = true;
                });
            if (error2 == false) {
                const user_uid = await userUid();
                const userref = doc(db, "users", user_uid);
                await updateDoc(userref, {
                    googleId: googleId
                });
            }

        }
        function parseJwt(token) {
            var base64Url = token.split('.')[1];
            var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            var jsonPayload = decodeURIComponent(window.atob(base64).split('').map(function (c) {
                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
            }).join(''));

            return JSON.parse(jsonPayload);
        };


    </script>

</body>

</html>